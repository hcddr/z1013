 AS V1.42 Beta [Bld 82] - source file z1013riesa.asm - page 1 - 9/1/2012 11:11:05


       1/       0 :                     	page	0
       2/       0 :                     	CPU	z80
       3/       0 :                     
       4/       0 :                     ;Z1013-MONITOR 2.02, A.2
       5/       0 :                     ;reass: 1988-1990 Volker Pohlers, Lomonossowallee 41/81, Greifswald, 2200
       6/       0 :                     ;basierend auf GENS3M-Listing des 2.02-Monitors von C.Fischer/Ilmenau
       7/       0 :                     ;Fassung für den Arnold-Assembler und vielfach erweiterte Kommentare
       8/       0 :                     ;Volker Pohlers, Sanitz, 23.04.2004
       9/       0 :                     ;letzte Änderung 15.12.2011
      10/       0 :                     
      11/       0 :                     ;
      12/       0 :                     ;gewünschten Monitortyp auskommentieren
      13/       0 :                     ;
      14/       0 :                     ;MONTYP	EQU	"Z1013_202"
      15/       0 : =Z1013_A2           MONTYP	EQU	"Z1013_A2"
      16/       0 :                     
      17/       0 :                     ;die wichtigsten Unterschiede A2 <-> 2.02
      18/       0 :                     ;- kein H- und A- und F-Kommandos
      19/       0 :                     ;- andere Adressen Windows-Speicher
      20/       0 :                     ;- andere INKEY-Routine und auch INCH-Routine!
      21/       0 :                     ;- KDO mit RST-Aufrufen programmiert, damit Verschiebung aller Routinen des Monitors!
      22/       0 :                     
      23/       0 :                     ; Makros
      24/       0 :                     hi              function x, (x>>8) & 0ffh	; High-Byte
      25/       0 :                     lo              function x, x & 0ffh		; Low-Byte
      26/       0 :                     
      27/       0 :                     ;
      28/       0 :                     ;RAM-Zellen
      29/       0 :                     ;
      30/       0 : =3H                 R20BT:	EQU	00003H			;Nummer des RST20-Calls
      31/       0 : =4H                 LAKEY:	EQU	00004H			;letztes Zeichen von Tastatur
      32/       0 : =BH                 BPADR:	EQU	0000BH			;Breakpointadresse
      33/       0 : =DH                 BPOPC:	EQU	0000DH			;Operandenfolge bei Breakpoint
      34/       0 : =13H                DATA:	EQU	00013H			;Adresse bei INHEX; intern f. INKEY b. A2
      35/       0 :                     ;SHILO:	EQU	00015H			;
      36/       0 : =16H                SOIL:	EQU	00016H			;Beginn Eingabezeile
      37/       0 : =1BH                ARG1:	EQU	0001BH			;1. Argument
      38/       0 : =1DH                ARG2:	EQU	0001DH			;2. Argument
      39/       0 : =1FH                BUFFA:	EQU	0001FH			;vom Cursor verdecktes Zeichen
      40/       0 : =20H                RST20:	EQU	00020H			;RST 20H
      41/       0 : =23H                ARG3:	EQU	00023H			;3. Argument
      42/       0 : =25H                SOIL2:	EQU	00025H			;Rest Eingabezeile
      43/       0 : =2BH                CUPOS:	EQU	0002BH			;aktuelle Cursorposition
      44/       0 : =33H                LSYNC:	EQU	00033H			;Kenntonlaenge
      45/       0 : =38H                RST38:	EQU	00038H			;RST 38H
      46/       0 : =>TRUE              	IF MONTYP == "Z1013_A2"
      47/       0 : =35H                WINDL:	EQU	00035H			;Windowlaenge
      48/       0 : =37H                KYBTS:	equ	00037h			;Tastaturroutinenzelle (Bit 4=Repeat)
      49/       0 : =3BH                WINDA:	EQU	0003BH			;Windowanfang
      50/       0 : =3DH                WINDE:	EQU	0003DH			;Windowende+1
      51/       0 : =>FALSE             	ELSE
      52/       0 :                     KYBTS:	EQU	00027H			;Tastaturroutinenzelle (0=ASCII,80h=Grafik)
      53/       0 :                     WINDL:	EQU	00047H			;Windowlaenge
      54/       0 :                     WINDA:	EQU	00049H			;Windowanfang
      55/       0 :                     WINDE:	EQU	0004BH			;Windowende+1
      56/       0 : [46]                	ENDIF
      57/       0 : =4DH                REGBR:	EQU	0004DH			;Registerrettebereich
      58/       0 : =5BH                REGAF:	EQU	0005BH			;Register AF
      59/       0 : =61H                REGPC:	EQU	00061H			;Register PC
      60/       0 : =63H                REGSP:	EQU	00063H			;Userstack
      61/       0 : =66H                NMI:	EQU	00066H
      62/       0 : =69H                NBYTE:	EQU	00069H			;Operand bei NEXT
      63/       0 : =6AH                SPADR:	EQU	0006AH			;SP-Zwischenspeicher
      64/       0 : =6CH                FBANZ:	EQU	0006CH			;Zwsp. Anz. Suchbytes bei FIND
      65/       0 : =90H                USRSK:	EQU	00090H			;Userstack
      66/       0 : =B0H                SYSSK:	EQU	000B0H			;Systemstack
      67/       0 : =B0H                USRKD:	EQU	SYSSK
      68/       0 :                     ;Bildschirm
      69/       0 : =EC00H              BWS:	EQU	0EC00H			;Beginn BWS
      70/       0 : =20H                BWSROW	EQU	32			;Anzahl Zeilen
      71/       0 : =20H                BWSCOL	EQU	32			;Anzahl Zeichen/Zeile
      72/       0 : =400H               BWSSZ	EQU	BWSROW*BWSCOL
      73/       0 :                     ;
      74/       0 :                     ;Markenvereinbarungen
      75/       0 :                     ;
      76/       0 : =CH                 CLS:	EQU	0CH
      77/       0 : =DH                 CR:	EQU	0DH
      78/       0 : =1BH                ESC:	EQU	27
      79/       0 : =1EH                NL:	EQU	1EH
      80/       0 : =AH                 LF:	EQU	0AH
      81/       0 :                     ;
      82/       0 :                     ;PIO
      83/       0 : =0H                 PIOAD	equ	00h 			; PIO A User
      84/       0 : =1H                 PIOAC	equ	01h
      85/       0 : =2H                 PIOBD	equ	02h			; PIO B, Bit0..4 Tastaturzeile
      86/       0 : =3H                 PIOBC	equ	03h			; Bit5->AB0 in, Bit6->TB in, Bit7->TB out
      87/       0 : =8H                 KEYP	equ	08h			; Port Ausgabe Tastaturspalte
      88/       0 :                     ;
      89/       0 :                     ; Makros für Systemaufrufe über RST 20h
      90/       0 :                     ;
      91/       0 :                     ROUTC:	MACRO
      92/       0 :                     	RST	20H
      93/       0 :                     	DB	0			; OUTCH
      94/       0 :                     	ENDM
      95/       0 :                     RINCH:	MACRO
      96/       0 :                     	RST	20H
      97/       0 :                     	DB	01h			; INCH
      98/       0 :                     	ENDM
      99/       0 :                     RPRST:	MACRO
     100/       0 :                     	RST	20H
     101/       0 :                     	DB	02h			; PRST
     102/       0 :                     	ENDM
     103/       0 :                     RINHX:	MACRO
     104/       0 :                     	RST	20H
     105/       0 :                     	DB	03h			; INHEX
     106/       0 :                     	ENDM
     107/       0 :                     RINKY:	MACRO
     108/       0 :                     	RST	20H
     109/       0 :                     	DB	04h			; INKEY
     110/       0 :                     	ENDM
     111/       0 :                     RINLN:	MACRO
     112/       0 :                     	RST	20H
     113/       0 :                     	DB	05h			; INLIN
     114/       0 :                     	ENDM
     115/       0 :                     ROTHX:	MACRO
     116/       0 :                     	RST	20H
     117/       0 :                     	DB	06h			; OUTHX
     118/       0 :                     	ENDM
     119/       0 :                     ROTHL:	MACRO
     120/       0 :                     	RST	20H
     121/       0 :                     	DB	07h			; OUTHL
     122/       0 :                     	ENDM
     123/       0 :                     ROTHS:	MACRO
     124/       0 :                     	RST	20H
     125/       0 :                     	DB	0Ch			; OTHLS
     126/       0 :                     	ENDM
     127/       0 :                     ROTDP:	MACRO
     128/       0 :                     	RST	20H
     129/       0 :                     	DB	0Dh			; OUTDP
     130/       0 :                     	ENDM
     131/       0 :                     ROTSP:	MACRO
     132/       0 :                     	RST	20H
     133/       0 :                     	DB	0Eh			; OUTSP
     134/       0 :                     	ENDM
     135/       0 :                     ;
     136/       0 :                     ;
     137/       0 :                     ;
     138/    F000 :                     	ORG	0F000H
     139/    F000 :                     ;
     140/    F000 :                     ;-------------------------------------------------------------------------------
     141/    F000 :                     ; Start
     142/    F000 :                     ;-------------------------------------------------------------------------------
     143/    F000 :                     
     144/    F000 : 18 0D               INIT:	JR	INIT2
     145/    F002 :                     ;Initialisierung
     146/    F002 : 21 4D 00            INIT1:	LD	HL,REGBR		;Registerrette-
     147/    F005 : 11 4E 00            	LD	DE,REGBR+1		;bereich loeschen
     148/    F008 : 36 00               	LD	(HL),0
     149/    F00A : 01 15 00            	LD	BC,0015H
     150/    F00D : ED B0               	LDIR
     151/    F00F : 31 B0 00            INIT2:	LD	SP,SYSSK		;System-Stack
     152/    F012 : =>FALSE             	IF MONTYP == "Z1013_202"
     153/    F012 :                     	xor	a			;Tastaturschalter
     154/    F012 :                     	ld	(KYBTS), a		;auf ASCII
     155/    F012 : [152]               	ENDIF
     156/    F012 : 3E C3               	LD	A,0C3H			;JMP ...
     157/    F014 : 32 20 00            	LD	(RST20),A
     158/    F017 : 21 D5 F0            	LD	HL,RST1			;RST20 eintragen
     159/    F01A : 22 21 00            	LD	(RST20+1),HL
     160/    F01D : 3E CF               	LD	A,11001111b		;PIO Port B init.
     161/    F01F : D3 03               	OUT	PIOBC, A		;BIT-Mode 3
     162/    F021 : =>FALSE             	IF	MONTYP <> "Z1013_A2"
     163/    F021 :                     	LD	A,01111111b		;BIT7-Ausgang
     164/    F021 : =>TRUE              	ELSE
     165/    F021 : 3E 6F               	LD	A,01101111b		;Bit7 und Bit4 Ausg.
     166/    F023 : [162]               	ENDIF
     167/    F023 : D3 03               	OUT	PIOBC, A
     168/    F025 : 21 0D F2            	LD	HL,MONTB		;System-RAM init.
     169/    F028 : 11 33 00            	LD	DE,LSYNC
     170/    F02B : 01 0C 00            	LD	BC,INCH-MONTB		;Laenge Tabelle
     171/    F02E : ED B0               	LDIR
     172/    F030 :                     ;Systemmeldung
     173/    F030 : (MACRO)             	RPRST
     173/    F030 : E7                          RST     20H
     173/    F031 : 02                          DB      02h                     ; PRST
     174/    F032 : 0C                  	DB	CLS
     175/    F033 : 0D                  	DB	CR
     176/    F034 : 0D                  	DB	CR
     177/    F035 : =>FALSE             	IF MONTYP == "Z1013_202"
     178/    F035 :                     	DB	"robotron Z 1013/2.02"
     179/    F035 : =>TRUE              	ELSEIF MONTYP == "Z1013_A2"
     180/    F035 : 72 6F 62 6F 74 72   	DB	"robotron Z 1013/A.2"
                    6F 6E 20 5A 20 31 
                    30 31 33 2F 41 2E 
                    32 
     181/    F048 : [177]               	ENDIF
     182/    F048 : 8D                  	DB	CR+80H
     183/    F049 :                     ;
     184/    F049 : 21 90 00            	LD	HL,USRSK		;User-Stack
     185/    F04C : 22 63 00            	LD	(REGSP),HL
     186/    F04F : ED 5E               	IM	2
     187/    F051 : 18 06               	JR	KDO2
     188/    F053 :                     ;
     189/    F053 :                     ;-------------------------------------------------------------------------------
     190/    F053 :                     ;Eingang Kommandomodus
     191/    F053 :                     ;-------------------------------------------------------------------------------
     192/    F053 :                     ;
     193/    F053 : 31 B0 00            KDO1:	LD	SP,SYSSK		;System-Stack
     194/    F056 : =>TRUE              	IF MONTYP == "Z1013_A2"
     195/    F056 : (MACRO)             	RPRST
     195/    F056 : E7                          RST     20H
     195/    F057 : 02                          DB      02h                     ; PRST
     196/    F058 : =>FALSE             	ELSE
     197/    F058 :                     	CALL	PRST7
     198/    F058 : [194]               	ENDIF
     199/    F058 : BF                  	DB	'?'+80H
     200/    F059 :                     KDO2:
     201/    F059 : =>TRUE              	IF MONTYP == "Z1013_A2"
     202/    F059 : (MACRO)             	RINLN
     202/    F059 : E7                          RST     20H
     202/    F05A : 05                          DB      05h                     ; INLIN
     203/    F05B : =>FALSE             	ELSE
     204/    F05B :                     	CALL	INLIN			;Zeile eingeben
     205/    F05B : [201]               	ENDIF
     206/    F05B : ED 5B 16 00         	LD	DE,(SOIL)
     207/    F05F : CD 07 F3            	CALL	SPACE			;Leerzeichen uebergehen
     208/    F062 : 47                  	LD	B,A			;B=1. Zeichen
     209/    F063 : 13                  	INC	DE
     210/    F064 : 1A                  	LD	A,(DE)
     211/    F065 : 4F                  	LD	C,A			;C=2. Zeichen
     212/    F066 : C5                  	PUSH	BC
     213/    F067 : 13                  	INC	DE
     214/    F068 : =>TRUE              	IF MONTYP == "Z1013_A2"
     215/    F068 : (MACRO)             	RINHX
     215/    F068 : E7                          RST     20H
     215/    F069 : 03                          DB      03h                     ; INHEX
     216/    F06A : =>FALSE             	ELSE
     217/    F06A :                     	CALL	INHEX
     218/    F06A : [214]               	ENDIF
     219/    F06A : 20 05               	JR	NZ, KDO3
     220/    F06C : 1A                  	LD	A,(DE)
     221/    F06D : FE 3A               	CP	A, ':'			;die alten Werte nehmen ?
     222/    F06F : 28 0D               	JR	Z, KDO4
     223/    F071 : 22 1B 00            KDO3:	LD	(ARG1),HL		;neue Argumente holen
     224/    F074 : =>TRUE              	IF MONTYP == "Z1013_A2"
     225/    F074 : (MACRO)             	RINHX
     225/    F074 : E7                          RST     20H
     225/    F075 : 03                          DB      03h                     ; INHEX
     226/    F076 : =>FALSE             	ELSE
     227/    F076 :                     	CALL	INHEX
     228/    F076 : [224]               	ENDIF
     229/    F076 : 22 1D 00            	LD	(ARG2),HL
     230/    F079 : =>TRUE              	IF MONTYP == "Z1013_A2"
     231/    F079 : (MACRO)             	RINHX
     231/    F079 : E7                          RST     20H
     231/    F07A : 03                          DB      03h                     ; INHEX
     232/    F07B : =>FALSE             	ELSE
     233/    F07B :                     	CALL	INHEX
     234/    F07B : [230]               	ENDIF
     235/    F07B : 22 23 00            	LD	(ARG3),HL
     236/    F07E : C1                  KDO4:	POP	BC
     237/    F07F : 08                  	EX	AF, AF'
     238/    F080 : ED 53 25 00         	LD	(SOIL2),DE		;Anfang 4. Argument
     239/    F084 :                     ;Kommando (in Reg B) suchen
     240/    F084 : 21 A7 F0            	LD	HL,KDOTB		;in Kommandotabelle
     241/    F087 : 7E                  KDO5:	LD	A,(HL)
     242/    F088 : B8                  	CP	A, B
     243/    F089 : 28 11               	JR	Z, KDO6			;wenn gefunden
     244/    F08B : 23                  	INC	HL
     245/    F08C : 23                  	INC	HL
     246/    F08D : 23                  	INC	HL
     247/    F08E : B7                  	OR	A			;Tabellenende?
     248/    F08F : 20 F6               	JR	NZ, KDO5		;nein
     249/    F091 : 78                  	LD	A,B
     250/    F092 : FE 40               	CP	A, '@'			;"@"-Kommando?
     251/    F094 : 20 BD               	JR	NZ, KDO1		;nein -> Eingabefehler
     252/    F096 : 21 B0 00            	LD	HL,USRKD		;Suchen in "@"-Kdo.tab.
     253/    F099 : 41                  	LD	B,C
     254/    F09A : 18 EB               	JR	KDO5
     255/    F09C :                     ;
     256/    F09C : 23                  KDO6:	INC	HL
     257/    F09D : 5E                  	LD	E,(HL)
     258/    F09E : 23                  	INC	HL
     259/    F09F : 56                  	LD	D,(HL)
     260/    F0A0 : EB                  	EX	DE,HL			;HL=UP-Adresse
     261/    F0A1 : 08                  	EX	AF, AF'
     262/    F0A2 : 01 59 F0            	LD	BC,KDO2			;Returnadresse
     263/    F0A5 : C5                  	PUSH	BC
     264/    F0A6 : E9                  	JP	(HL)			;Sprung zur Routine
     265/    F0A7 :                     ;
     266/    F0A7 :                     KDOTB:
     267/    F0A7 : =>FALSE             	IF MONTYP == "Z1013_202"
     268/    F0A7 :                     	DB	"A"
     269/    F0A7 :                     	DW	A_KDO
     270/    F0A7 : [267]               	ENDIF
     271/    F0A7 : 42                  	DB	"B"
     272/    F0A8 : C4 F5               	DW	B_KDO
     273/    F0AA : 43                  	DB	"C"
     274/    F0AB : 9B F7               	DW	C_KDO
     275/    F0AD : 44                  	DB	"D"
     276/    F0AE : 0B F5               	DW	D_KDO
     277/    F0B0 : 45                  	DB	"E"
     278/    F0B1 : D6 F5               	DW	E_KDO
     279/    F0B3 : =>FALSE             	IF MONTYP <> "Z1013_A2"
     280/    F0B3 :                     	DB	"F"
     281/    F0B3 :                     	DW	F_KDO
     282/    F0B3 : [279]               	ENDIF
     283/    F0B3 : 47                  	DB	"G"
     284/    F0B4 : F0 F5               	DW	G_KDO
     285/    F0B6 : =>FALSE             	IF MONTYP == "Z1013_202"
     286/    F0B6 :                     	DB	"H"
     287/    F0B6 :                     	DW	H_KDO
     288/    F0B6 : [285]               	ENDIF
     289/    F0B6 : 49                  	DB	"I"
     290/    F0B7 : 02 F0               	DW	INIT1
     291/    F0B9 : 4A                  	DB	"J"
     292/    F0BA : E2 F5               	DW	J_KDO
     293/    F0BC : 4B                  	DB	"K"
     294/    F0BD : 48 F5               	DW	K_KDO
     295/    F0BF : 4C                  	DB	"L"
     296/    F0C0 : 35 F4               	DW	CLOAD
     297/    F0C2 : 4D                  	DB	"M"
     298/    F0C3 : 62 F3               	DW	MEM
     299/    F0C5 : 4E                  	DB	"N"
     300/    F0C6 : 4B F7               	DW	N_KDO
     301/    F0C8 : 52                  	DB	"R"
     302/    F0C9 : 1C F6               	DW	R_KDO
     303/    F0CB : 53                  	DB	"S"
     304/    F0CC : A6 F3               	DW	CSAVE
     305/    F0CE : 54                  	DB	"T"
     306/    F0CF : 5A F5               	DW	T_KDO
     307/    F0D1 : 57                  	DB	"W"
     308/    F0D2 : F5 F6               	DW	W_KDO
     309/    F0D4 : 00                  	DB	0
     310/    F0D5 :                     ;
     311/    F0D5 :                     ;-------------------------------------------------------------------------------
     312/    F0D5 :                     ;Eingang bei RST 20H
     313/    F0D5 :                     ;-------------------------------------------------------------------------------
     314/    F0D5 :                     ;
     315/    F0D5 : E3                  RST1:	EX	(SP),HL
     316/    F0D6 : F5                  	PUSH	AF
     317/    F0D7 : 7E                  	LD	A,(HL)			;Datenbyte hinter Ruf holen
     318/    F0D8 : 32 03 00            	LD	(R20BT),A		;und ablegen
     319/    F0DB : 23                  	INC	HL			;Returnadresse erhoehen
     320/    F0DC : F1                  	POP	AF
     321/    F0DD : E3                  	EX	(SP),HL
     322/    F0DE :                     ;
     323/    F0DE : E5                  	PUSH	HL
     324/    F0DF : C5                  	PUSH	BC
     325/    F0E0 : F5                  	PUSH	AF
     326/    F0E1 : 21 F5 F0            	LD	HL,RSTTB
     327/    F0E4 : 3A 03 00            	LD	A,(R20BT)
     328/    F0E7 : CB 27               	SLA	A
     329/    F0E9 : 4F                  	LD	C,A
     330/    F0EA : 06 00               	LD	B,0
     331/    F0EC : 09                  	ADD	HL,BC			;HL=Adresse in Tab.
     332/    F0ED : 7E                  	LD	A,(HL)
     333/    F0EE : 23                  	INC	HL
     334/    F0EF : 66                  	LD	H,(HL)
     335/    F0F0 : 6F                  	LD	L,A			;HL=UP-Adresse
     336/    F0F1 : F1                  	POP	AF
     337/    F0F2 : C1                  	POP	BC
     338/    F0F3 : E3                  	EX	(SP),HL			;Ansprung der
     339/    F0F4 : C9                  	RET				;Routine
     340/    F0F5 :                     ;
     341/    F0F5 : 58 F2               RSTTB:	DW	OUTCH			;DB 0
     342/    F0F7 : 19 F2               	DW	INCH			;DB 1
     343/    F0F9 : E2 F2               	DW	PRST7			;DB 2
     344/    F0FB : 31 F3               	DW	INHEX			;DB 3
     345/    F0FD : 19 F1               	DW	INKEY			;DB 4
     346/    F0FF : F0 F2               	DW	INLIN			;DB 5
     347/    F101 : 3E F3               	DW	OUTHX			;DB 6
     348/    F103 : 57 F3               	DW	OUTHL			;DB 7
     349/    F105 : A6 F3               	DW	CSAVE			;DB 8
     350/    F107 : 35 F4               	DW	CLOAD			;DB 9
     351/    F109 : 62 F3               	DW	MEM			;DB 10
     352/    F10B : F5 F6               	DW	W_KDO			;DB 11
     353/    F10D : 04 F6               	DW	OTHLS			;DB 12
     354/    F10F : 01 F6               	DW	OUTDP			;DB 13
     355/    F111 : 0C F6               	DW	OUTSP			;DB 14
     356/    F113 : 5A F5               	DW	T_KDO			;DB 15
     357/    F115 : F6 F2               	DW	INSTR			;DB 16
     358/    F117 : 48 F5               	DW	K_KDO			;DB 17
     359/    F119 : =>FALSE             	IF MONTYP <> "Z1013_A2"
     360/    F119 :                     	DW	H_KDO			;DB 18
     361/    F119 :                     	DW	A_KDO			;DB 19
     362/    F119 : [359]               	ENDIF
     363/    F119 :                     
     364/    F119 :                     ;
     365/    F119 :                     ;-------------------------------------------------------------------------------
     366/    F119 :                     ;Eingabe ein Zeichen von der Tastatur in A
     367/    F119 :                     ;-------------------------------------------------------------------------------
     368/    F119 :                     ;
     369/    F119 : =>FALSE             	IF MONTYP == "Z1013_202"
     370/    F119 :                     
     371/    F119 :                     ; Tastatur
     372/    F119 :                     ; --------
     373/    F119 :                     ;
     374/    F119 :                     ;      -------------------------------------------------        I-------I
     375/    F119 :                     ;      I X   I Y   I Z   I [ { I \ | I ] } I ^ ~ I _   I        I S1 S2 I
     376/    F119 :                     ;  RZ0-I     I     I     I     I     I     I     I     I        I       I
     377/    F119 :                     ;      I @ ` I A   I B   I C   I D   I E   I F   I G   I        I S0    I
     378/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I        I-------I
     379/    F119 :                     ;      I 0   I 1 ! I 2 " I 3 # I 4 $ I 5 % I 6 & I 7 ' I
     380/    F119 :                     ;  RZ1-I     I     I     I     I     I     I     I     I        S0 = normal, Großbuchstaben
     381/    F119 :                     ;      I H   I I   I J   I K   I L   I M   I N   I O   I        S1 = Ziffern etc.
     382/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I        S2 = Sonderzeichen etc.
     383/    F119 :                     ;      I 8 ( I 9 ) I : * I ; + I < , I = - I > . I ? / I        S3 = Kleinbuchstaben
     384/    F119 :                     ;  RZ2-I     I     I     I     I     I     I     I     I        S4 = Ctrl.
     385/    F119 :                     ;      I P   I Q   I R   I S   I T   I U   I V   I W   I
     386/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     387/    F119 :                     ;      I     I     I     I     I     I     I     I     I
     388/    F119 :                     ;  RZ3-I     I     I     I     I     I     I     I     I
     389/    F119 :                     ;      I S1  I S2  I S3  I S4  I <-  I SP  I ->  I ENT I
     390/    F119 :                     ;      -------------------------------------------------
     391/    F119 :                     ;         !     !     !     !     !     !     !     !
     392/    F119 :                     ;        RS0   RS1   RS2   RS3   RS4   RS5   RS6   RS7
     393/    F119 :                     ;
     394/    F119 :                     ; IN 2 |                     OUT 8
     395/    F119 :                     
     396/    F119 :                     
     397/    F119 :                     inkey:					;bei Ret A=ASCII
     398/    F119 :                     	xor	a
     399/    F119 :                     	ld	h, a
     400/    F119 :                     	ld	l, a
     401/    F119 :                     	call	ink9			;Tastenabfrage
     402/    F119 :                     	jr	nc, ink8		;Cy=0 keine Taste
     403/    F119 :                     	add	hl, de
     404/    F119 :                     	call	ink12			;restl. Spalten
     405/    F119 :                     	ld	c, 44h			;Tastaturcodetabelle 0044H Shift-Ebene 0 40h,48h,50h
     406/    F119 :                     	jr	c, ink1			;Cy=1 2.Taste gedr.
     407/    F119 :                     	ex	de, hl
     408/    F119 :                     	bit	3, d			;Abfrage Zeile 3
     409/    F119 :                     	jr	z, ink2			;Z=1 Taste gedr.
     410/    F119 :                     	jr	ink3
     411/    F119 :                     ink1:	bit	3, d			;2. Taste ? Zeile 3
     412/    F119 :                     	jr	z, ink2			;Z=1 Taste gedr.
     413/    F119 :                     	ex	de, hl
     414/    F119 :                     	bit	3, d			;1. Taste ? Zeile 3
     415/    F119 :                     	jr	nz, ink3		;Z=1 Taste gedr.
     416/    F119 :                     ink2:	call	ink13			;Welche Taste in Z3
     417/    F119 :                     	push	bc
     418/    F119 :                     	call	ink22			;Summand holen
     419/    F119 :                     	pop	bc
     420/    F119 :                     	jr	z, ink4			;Z=0 kein Summ.
     421/    F119 :                     	ex	de, hl
     422/    F119 :                     ink3:	call	ink22			;Summand holen
     423/    F119 :                     	jr	nz, ink8		;Z=0 kein Summ.
     424/    F119 :                     ink4:	add	a, e
     425/    F119 :                     	ld	hl, KYBTS
     426/    F119 :                     	add	a, (hl)
     427/    F119 :                     ;Berechnung Ascii-Wert abgeschlossen
     428/    F119 :                     ink5:	ld	hl, LAKEY		;Softwareentprel-
     429/    F119 :                     	cp	(hl)			;lung, verhindert
     430/    F119 :                     	jr	z, inkey		;Repeat-Funktion
     431/    F119 :                     	ld	b, a
     432/    F119 :                     	ld	a, (hl)
     433/    F119 :                     	or	a
     434/    F119 :                     	ld	a, b
     435/    F119 :                     	jr	nz, inkey		;Z=1 vorher keine
     436/    F119 :                     	ld	(LAKEY), a		;Taste gedrueckt
     437/    F119 :                     	cp	91h			;(S4/A)
     438/    F119 :                     	jr	z, ink6			;Z=1- ASCII
     439/    F119 :                     	cp	17h			;(S4/G)
     440/    F119 :                     	ret	nz			;Z=0 Ruecksprung
     441/    F119 :                     	ld	a, 80h
     442/    F119 :                     	jr	ink7
     443/    F119 :                     ink6:	xor	a
     444/    F119 :                     ink7:	ld	(KYBTS), a
     445/    F119 :                     ink8:	xor	a			;Ruecksprung wenn
     446/    F119 :                     	ld	(LAKEY), a		;keine Taste gedr.
     447/    F119 :                     	ret				;mit A=0
     448/    F119 :                     ;UP Tastenabfrage
     449/    F119 :                     ink9:	ld	e, a			;E=Spaltennummer
     450/    F119 :                     	out	(KEYP), a		;Ausgabe Spalte
     451/    F119 :                     	ld	b, 20h
     452/    F119 :                     ink10:	in	a, (PIOBD)
     453/    F119 :                     	and	0Fh
     454/    F119 :                     	ld	d, a			;D=Zeilennummer
     455/    F119 :                     	in	a, (PIOBD)
     456/    F119 :                     	and	0Fh
     457/    F119 :                     	cp	d
     458/    F119 :                     	jr	nz, ink11		;Z=0 Taste prellt
     459/    F119 :                     	cp	0Fh
     460/    F119 :                     	ret	nz			;Z=0 Taste gedr.
     461/    F119 :                     ink11:	djnz	ink10
     462/    F119 :                     ink12:	ld	a, e			;Erhoeh. Spalten-
     463/    F119 :                     	inc	a			;zahl
     464/    F119 :                     	cp	8
     465/    F119 :                     	jr	nz, ink9		;Z=1 alle Tasten
     466/    F119 :                     	ret				;abgefragt
     467/    F119 :                     ;Taste in Z3
     468/    F119 :                     ink13:	ld	a, 1			;Untersuchung
     469/    F119 :                     	cp	e			;welche Taste in
     470/    F119 :                     	jr	z, ink19		;Zeile 3 gedr. ist
     471/    F119 :                     	jr	nc, ink18		;E=Spaltenzahl
     472/    F119 :                     	add	a, 2			;E=0 - C=41H
     473/    F119 :                     	cp	e			;E=1 - C=3EH
     474/    F119 :                     	jr	z, ink21		;E=2 - C=3BH
     475/    F119 :                     	jr	nc, ink20		;E=3 - C=35H
     476/    F119 :                     	add	a, 2			;E=4 - A=08H
     477/    F119 :                     	cp	e			;E=5 - A=20H
     478/    F119 :                     	jr	z, ink15		;E=6 - A=09H
     479/    F119 :                     	jr	nc, ink16		;E=7 - A=0DH
     480/    F119 :                     	add	a, 2
     481/    F119 :                     	cp	e
     482/    F119 :                     	jr	z, ink14
     483/    F119 :                     	ld	a, 9			; ->
     484/    F119 :                     	jr	ink17
     485/    F119 :                     ink14:	ld	a, 0Dh			; ENT
     486/    F119 :                     	jr	ink17
     487/    F119 :                     ink15:	ld	a, 20h			; SPACE
     488/    F119 :                     	jr	ink17
     489/    F119 :                     ink16:	ld	a, 8			; <-
     490/    F119 :                     ink17:	pop	bc
     491/    F119 :                     	jr	ink5
     492/    F119 :                     ink18:	ld	c, 41h			;Tastaturcodetabelle 0041H Shift-Ebene 1 58h,30h,38h
     493/    F119 :                     	ret
     494/    F119 :                     ink19:	ld	c, 3Eh			;Tastaturcodetabelle 003EH Shift-Ebene 2 78h,20h,28h
     495/    F119 :                     	ret
     496/    F119 :                     ink20:	ld	c, 3Bh			;Tastaturcodetabelle 003BH Shift-Ebene 3 60h,68h,70h
     497/    F119 :                     	ret
     498/    F119 :                     ink21:	ld	c, 35h			;Tastaturcodetabelle 0035H Shift-Ebene 4 10h,00h,08h
     499/    F119 :                     	ret
     500/    F119 :                     
     501/    F119 :                     ;Summand holen
     502/    F119 :                     ink22:	bit	0, d			;Abfrage Zeile 0
     503/    F119 :                     	jr	nz, ink24		;Z=0 keine Taste
     504/    F119 :                     ink23:	ld	l, c
     505/    F119 :                     	ld	h, 0
     506/    F119 :                     	ld	a, (hl)
     507/    F119 :                     	ret
     508/    F119 :                     ink24:	inc	c
     509/    F119 :                     	bit	1, d			;Abfrage Zeile 1
     510/    F119 :                     	jr	nz, ink25		;Z=0 keine Taste
     511/    F119 :                     	jr	ink23
     512/    F119 :                     ink25:	inc	c
     513/    F119 :                     	bit	2, d			;Abfrage Zeile 2
     514/    F119 :                     	ret	nz			;Z=0 keine Taste
     515/    F119 :                     	jr	ink23
     516/    F119 :                     
     517/    F119 : =>TRUE              	ELSEIF MONTYP == "Z1013_A2"
     518/    F119 :                     
     519/    F119 :                     ; Tastatur
     520/    F119 :                     ; --------
     521/    F119 :                     ;
     522/    F119 :                     ;      -------------------------------------------------
     523/    F119 :                     ;      I   ! I   # I   % I   ' I   ) I   = I     I     I
     524/    F119 :                     ;  RZ0-I     I     I     I     I     I     I     I     I
     525/    F119 :                     ;      I 1   I 3   I 5   I 7   I 9   I -   I GRA I     I
     526/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     527/    F119 :                     ;      I     I     I     I     I     I   ` I     I     I
     528/    F119 :                     ;  RZ1-I     I     I     I     I     I     I     I     I
     529/    F119 :                     ;      I Q   I E   I T   I U   I O   I @   I ENT I     I
     530/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     531/    F119 :                     ;      I     I     I     I     I     I   : I     I     I
     532/    F119 :                     ;  RZ2-I     I     I     I     I     I     I Cu  I     I
     533/    F119 :                     ;      I A   I D   I G   I J   I L   I *   I leftI     I
     534/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     535/    F119 :                     ;      I     I     I     I     I   > I   ~ I     I     I
     536/    F119 :                     ;  RZ3-I     I     I     I     I     I     I Cu  I     I
     537/    F119 :                     ;      I Y   I C   I B   I M   I     I ^   I rghtI     I
     538/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     539/    F119 :                     ;      I   " I   $ I   & I   ( I     I   { I     I     I
     540/    F119 :                     ;  RZ4-I     I     I     I     I     I     I     I     I
     541/    F119 :                     ;  RZ0 I 2   I 4   I 6   I 8   I 0   I [   I Spc I     I
     542/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     543/    F119 :                     ;      I     I     I     I     I     I         } I     I
     544/    F119 :                     ;  RZ5-I     I     I     I     I     I     I     I     I
     545/    F119 :                     ;  RZ1 I W   I R   I Z   I I   I P   I ]   I CTRLI     I
     546/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     547/    F119 :                     ;      I     I     I     I     I   ; I   | I     I     I
     548/    F119 :                     ;  RZ6-I     I     I     I     I     I     I Cu  I     I
     549/    F119 :                     ;  RZ2 I S   I F   I H   I K   I +   I \\  I up  I ShftI
     550/    F119 :                     ;      I-----+-----+-----+-----+-----+-----+-----+-----I
     551/    F119 :                     ;      I     I     I     I   < I   ? I    I     I     I
     552/    F119 :                     ;  RZ7-I     I     I     I     I     I     I Cu  I ShftI
     553/    F119 :                     ;  RZ3 I X   I V   I N   I ,   I /   I _   I downI LockI
     554/    F119 :                     ;      -------------------------------------------------
     555/    F119 :                     ;         !     !     !     !     !     !     !     !
     556/    F119 :                     ;        RS0   RS1   RS2   RS3   RS4   RS5   RS6   RS7
     557/    F119 :                     ;
     558/    F119 :                     ; IN 2 |                     OUT 8
     559/    F119 :                     ;
     560/    F119 :                     ; Zeile 4..7 werden auf Zeile 0..3 gemuxt, wenn Pio B4=1
     561/    F119 :                     
     562/    F119 : 21 37 00            inkey:	ld	hl, KYBTS		; Merkzelle
     563/    F11C : 3E 5B               	ld	a, 01011011b
     564/    F11E : A6                  	and	(hl)
     565/    F11F : 77                  	ld	(hl), a
     566/    F120 : DD 21 C6 F7         	ld	ix, keytab		; Tastaturcodetabelle
     567/    F124 : CD B9 F1            	call	ink16			; normale Taste gedrückt?
     568/    F127 : 30 0D               	jr	nc, ink1		; nein, dann evtl. Fkt.taste?
     569/    F129 : D5                  	push	de			;
     570/    F12A : CB FE               	set	7, (hl)
     571/    F12C : CD F9 F1            	call	ink20			; ASCII-Code aus Tabelle ermitteln
     572/    F12F : 32 13 00            	ld	(DATA), a		; ASCII-Code
     573/    F132 : D1                  	pop	de			;
     574/    F133 : CD C0 F1            	call	ink18			;
     575/    F136 :                     ; Funktionstasten (Spalte 6)
     576/    F136 : DD 21 F6 F7         ink1:	ld	ix, tab2		; Tastaturcodetabelle
     577/    F13A : 1E 06               	ld	e, 6			; Spalte 6
     578/    F13C : CD CE F1            	call	ink19			; Spalte abfragen
     579/    F13F : 28 3B               	jr	z, ink9			; wenn keine Taste gedrückt
     580/    F141 : CB 41               	bit	0, c			; GRA ?
     581/    F143 : 28 08               	jr	z, ink2
     582/    F145 : CB 69               	bit	5, c			; CTRL ?
     583/    F147 : 28 12               	jr	z, ink5
     584/    F149 : CD F9 F1            	call	ink20			; ASCII-Code aus Tabelle ermitteln
     585/    F14C : C9                  	ret				; A = ASCII-Code
     586/    F14D :                     ; GRA
     587/    F14D : 3E 02               ink2:	ld	a, 2
     588/    F14F : CB 9E               	res	3, (hl)
     589/    F151 : CB 76               ink3:	bit	6, (hl)
     590/    F153 : 20 04               	jr	nz, ink4
     591/    F155 : CB F6               	set	6, (hl)			; Statusbit Grafikmode setzen
     592/    F157 : AE                  	xor	(hl)
     593/    F158 : 77                  	ld	(hl), a
     594/    F159 : AF                  ink4:	xor	a
     595/    F15A : C9                  	ret
     596/    F15B :                     ; CTRL
     597/    F15B : CB EE               ink5:	set	5, (hl)			; Statusbit CTRL setzen
     598/    F15D : CB 7E               	bit	7, (hl)
     599/    F15F : 28 1B               	jr	z, ink9
     600/    F161 : 3A 13 00            	ld	a, (DATA)
     601/    F164 : CB 77               	bit	6, a
     602/    F166 : 20 02               	jr	nz, ink6
     603/    F168 : CB E7               	set	4, a
     604/    F16A : E6 1F               ink6:	and	1Fh
     605/    F16C : CB 4E               ink7:	bit	1, (hl)
     606/    F16E : C8                  	ret	z
     607/    F16F : CB FF               	set	7, a			; Bit 7 := 1 (Grafikzeichen)
     608/    F171 : C9                  	ret
     609/    F172 :                     ; Shift
     610/    F172 : CB B6               ink8:	res	6, (hl)
     611/    F174 : CB 7E               	bit	7, (hl)
     612/    F176 : C8                  	ret	z
     613/    F177 : 3A 13 00            	ld	a, (DATA)
     614/    F17A : 18 F0               	jr	ink7
     615/    F17C :                     ;
     616/    F17C : 1E 07               ink9:	ld	e, 7			; Spalte 7 (Shift)
     617/    F17E : CD CE F1            	call	ink19			; Taste gedrückt?
     618/    F181 : 28 0C               	jr	z, ink10		; nein
     619/    F183 : CB 79               	bit	7, c			; Shift Lock
     620/    F185 : 28 2D               	jr	z, ink15
     621/    F187 : CB 71               	bit	6, c			; Shift
     622/    F189 : 20 E7               	jr	nz, ink8
     623/    F18B : CB 6E               	bit	5, (hl)
     624/    F18D : 20 25               	jr	nz, ink15
     625/    F18F : CB 7E               ink10:	bit	7, (hl)			;
     626/    F191 : C8                  	ret	z			; nein
     627/    F192 :                     ; Repeat
     628/    F192 : 3A 13 00            	ld	a, (DATA)
     629/    F195 : CB 71               	bit	6, c
     630/    F197 : 28 06               	jr	z, ink11
     631/    F199 : CB 5E               	bit	3, (hl)
     632/    F19B : 28 CF               	jr	z, ink7
     633/    F19D : 18 04               	jr	ink12
     634/    F19F : CB 5E               ink11:	bit	3, (hl)
     635/    F1A1 : 20 C9               	jr	nz, ink7
     636/    F1A3 : 47                  ink12:	ld	b, a
     637/    F1A4 : E6 30               	and	30h
     638/    F1A6 : 78                  	ld	a, b
     639/    F1A7 : E2 AE F1            	jp	po, ink13
     640/    F1AA : CB A7               	res	4, a
     641/    F1AC : 18 02               	jr	ink14
     642/    F1AE : CB E7               ink13:	set	4, a
     643/    F1B0 : CB EF               ink14:	set	5, a
     644/    F1B2 : 18 B8               	jr	ink7
     645/    F1B4 :                     ; Shift Lock
     646/    F1B4 : 3E 08               ink15:	ld	a, 8
     647/    F1B6 : C3 51 F1            	jp	ink3
     648/    F1B9 :                     ; normale Taste gedrückt?
     649/    F1B9 :                     ; IN: IX: Tastaturcodetabelle
     650/    F1B9 :                     ; OUT: Z-Flag=1: Taste gedrückt
     651/    F1B9 :                     ;      E = Spalte
     652/    F1B9 :                     ;      Cy=0: keine Taste gedrückt
     653/    F1B9 :                     ;	IX: Tastaturcodetabelle aktuelle Zeile
     654/    F1B9 : 1E 00               ink16:	ld	e, 0			; e = Spalte (0..5)
     655/    F1BB : CD CE F1            ink17:	call	ink19			; Taste in Spalte gedrückt?
     656/    F1BE : 37                  	scf
     657/    F1BF : C0                  	ret	nz			; wenn gedrueckt
     658/    F1C0 : 1C                  ink18:	inc	e			; sonst naechste Spalte
     659/    F1C1 : 01 08 00            	ld	bc, 8			; und Pointer auf Tastaturcode-
     660/    F1C4 : DD 09               	add	ix, bc			; tabelle erhöhen
     661/    F1C6 : 7B                  	ld	a, e
     662/    F1C7 : FE 06               	cp	6			; Spalte RS6 erreicht?
     663/    F1C9 : 20 F0               	jr	nz, ink17		; bis alle 7 Spalten
     664/    F1CB : 37                  	scf
     665/    F1CC : 3F                  	ccf				; Cy=0
     666/    F1CD : C9                  	ret
     667/    F1CE :                     ; Abfrage einer Spalte
     668/    F1CE :                     ; IN E: Spalte
     669/    F1CE :                     ; OUT: C: Zeile
     670/    F1CE :                     ;      A = 0
     671/    F1CE :                     ;      Z-Flag=1: Taste gedrückt
     672/    F1CE : 7B                  ink19:	ld	a, e			; e = Spalte
     673/    F1CF : D3 08               	out	(KEYP), a		; Spalte aktivieren
     674/    F1D1 : D3 02               	out	(PIOBD), a		; Pio B4 = 0 (Zeile 0..3)
     675/    F1D3 : DB 02               	in	a, (PIOBD)		; Zeilen 0..3 einlesen
     676/    F1D5 : E6 0F               	and	0Fh
     677/    F1D7 : 4F                  	ld	c, a
     678/    F1D8 : CB E7               	set	4, a			; PIO B4 = 1 (Zeile 4..7)
     679/    F1DA : D3 02               	out	(PIOBD), a
     680/    F1DC : DB 02               	in	a, (PIOBD)		; Zeilen 4..7 einlesen
     681/    F1DE : CB 27               	sla	a			; in obere 4 Bits verschieben
     682/    F1E0 : CB 27               	sla	a
     683/    F1E2 : CB 27               	sla	a
     684/    F1E4 : CB 27               	sla	a
     685/    F1E6 : 57                  	ld	d, a			; d = Zeile 4..7
     686/    F1E7 : 81                  	add	a, c
     687/    F1E8 : 4F                  	ld	c, a			; c = Zeile 0..7
     688/    F1E9 :                     ; Entprellen ...
     689/    F1E9 : AF                  	xor	a			; a = 0
     690/    F1EA : D3 02               	out	(PIOBD), a		; Pio B4 = 0 (Zeile 0..3)
     691/    F1EC : DB 02               	in	a, (PIOBD)		; Zeilen 0..3 einlesen
     692/    F1EE : E6 0F               	and	0Fh
     693/    F1F0 : 82                  	add	a, d
     694/    F1F1 : B9                  	cp	c			; noch gleicher Wert?
     695/    F1F2 : 20 DA               	jr	nz, ink19		; nein
     696/    F1F4 : 2F                  	cpl
     697/    F1F5 : B7                  	or	a
     698/    F1F6 : 3E 00               	ld	a, 0
     699/    F1F8 : C9                  	ret
     700/    F1F9 :                     ; ASCII-Code aus Tabelle ermitteln
     701/    F1F9 :                     ; IN: C = Zeile = Bit 0..7
     702/    F1F9 :                     ;     IX = Tastaturcodetabelle
     703/    F1F9 : 11 00 00            ink20:	ld	de, 0
     704/    F1FC : 06 08               	ld	b, 8			; max 8 Zeilen
     705/    F1FE : CB 29               ink21:	sra	c			; nächste Zeile
     706/    F200 : 30 03               	jr	nc, ink22
     707/    F202 : 1C                  	inc	e
     708/    F203 : 10 F9               	djnz	ink21
     709/    F205 : DD 19               ink22:	add	ix, de
     710/    F207 : DD 7E 00            	ld	a, (ix+0)		; A = ASCII-Code
     711/    F20A : CB B6               	res	6, (hl)			;
     712/    F20C : C9                  	ret
     713/    F20D :                     
     714/    F20D : [369]               	ENDIF
     715/    F20D :                     ;
     716/    F20D :                     ;-------------------------------------------------------------------------------
     717/    F20D :                     ;Monitorinit., wird nach 0033H (LSYNC) umgeladen
     718/    F20D :                     ;-------------------------------------------------------------------------------
     719/    F20D :                     ;
     720/    F20D :                     MONTB:
     721/      33 :                     	phase	0033H
     722/      33 :                     
     723/      33 : =>FALSE             	IF MONTYP == "Z1013_202"
     724/      33 :                     
     725/      33 :                     	DW	2000			;Kenntonlaenge LSYNC
     726/      33 :                     	DB	10h,00h,08h		;Tastaturcodetabelle 0035H Shift-Ebene 4
     727/      33 :                     	JP	KDO1			;RST38-Sprung	RST38
     728/      33 :                     	db	60h,68h,70h		;Tastaturcodetabelle 003BH Shift-Ebene 3
     729/      33 :                     	db	78h,20h,28h		;Tastaturcodetabelle 003EH Shift-Ebene 2
     730/      33 :                     	db	58h,30h,38h		;Tastaturcodetabelle 0041H Shift-Ebene 1
     731/      33 :                     	db	40h,48h,50h		;Tastaturcodetabelle 0044H Shift-Ebene 0
     732/      33 :                     	DW	03E0H			;WINDOW-Laenge	WINDL
     733/      33 :                     	DW	BWS			;WINDOW-Anfang	WINDA
     734/      33 :                     	DW	BWS+BWSSZ		;WINDOW-Ende	WINDE
     735/      33 :                     
     736/      33 : =>TRUE              	ELSEIF MONTYP == "Z1013_A2"
     737/      33 :                     
     738/      33 : D0 07               	dw	2000			;Kenntonlaenge 	LSYNC
     739/      35 : E0 03               	DW	BWSSZ-BWSCOL		;WINDOW-Laenge 	WINDL
     740/      37 : 00                  	db	0			;Status-Merkzelle f. INKEY KYBTS
     741/      38 : C3 53 F0            	jp	KDO1			;RST38-Sprung	RST38
     742/      3B : 00 EC               	DW	BWS			;WINDOW-Anfang	WINDA
     743/      3D : 00 F0               	DW	BWS+BWSSZ		;WINDOW-Ende	WINDE
     744/      3F :                     
     745/      3F : [723]               	ENDIF
     746/      3F :                     
     747/    F219 :                     	dephase
     748/    F219 :                     ;
     749/    F219 :                     ;-------------------------------------------------------------------------------
     750/    F219 :                     ;Zeichen von Tastatur holen, warten bis Taste gedrueckt
     751/    F219 :                     ;-------------------------------------------------------------------------------
     752/    F219 :                     ;
     753/    F219 : =>FALSE             	IF MONTYP == "Z1013_202"
     754/    F219 :                     
     755/    F219 :                     INCH:	push	bc
     756/    F219 :                     	push	de
     757/    F219 :                     	push	hl
     758/    F219 :                     INC1:	CALL	INKEY
     759/    F219 :                     	OR	A
     760/    F219 :                     	JR	Z, INC1			;keine Taste gedrueckt
     761/    F219 :                     	pop	hl
     762/    F219 :                     	pop	de
     763/    F219 :                     	pop	bc
     764/    F219 :                     	RET
     765/    F219 :                     
     766/    F219 : =>TRUE              	ELSEIF MONTYP == "Z1013_A2"
     767/    F219 :                     
     768/    F219 : DD E5               INCH:	push	ix
     769/    F21B : C5                  	push	bc
     770/    F21C : D5                  	push	de
     771/    F21D : E5                  	push	hl
     772/    F21E : 01 00 10            	ld	bc, 1000h		; B := 16; C := 0 (256)
     773/    F221 : C5                  INC1:	PUSH	BC
     774/    F222 : CD 19 F1            	CALL	INKEY			; ret: hl=KYBTS
     775/    F225 : C1                  	POP	BC
     776/    F226 : DD 21 04 00         	LD	IX, LAKEY
     777/    F22A : DD BE 00            	CP	(IX+0)
     778/    F22D : 20 1B               	JR	NZ, INC6		; wenn anderes Zeichen
     779/    F22F : B7                  	OR	A			; A = 0?
     780/    F230 : 28 16               	JR	Z, INC5			; wenn keine Taste gedückt
     781/    F232 : 0D                  INC2:	DEC	C
     782/    F233 : 20 FD               	JR	NZ, INC2		; kurz warten
     783/    F235 : CB 66               	BIT	4, (HL)			; Repeat?
     784/    F237 : 20 08               	JR	NZ, INC4		; ja -> gleich weiter
     785/    F239 : 11 00 08            	LD	DE, 800H		; sonst längeres Warten
     786/    F23C : 1B                  INC3:	DEC	DE
     787/    F23D : 7B                  	LD	A, E
     788/    F23E : B2                  	OR	D
     789/    F23F : 20 FB               	JR	NZ, INC3
     790/    F241 : 10 DE               INC4:	DJNZ	INC1			; 16x
     791/    F243 : CB E6               	SET	4, (HL)			; Repeat ein
     792/    F245 : AF                  	XOR	A			; A := 0, kein Zeichen
     793/    F246 : 18 02               	JR	INC6
     794/    F248 : CB A6               INC5:	RES	4, (HL)			; kein Repeat mehr
     795/    F24A : DD 77 00            INC6:	LD	(IX+0),	A		; LAKEY füllen
     796/    F24D : B7                  	OR	A			; A = 0?
     797/    F24E : 28 D1               	JR	Z, INC1			; nochmal, bis Taste gedrückt
     798/    F250 : E1                  	POP	HL
     799/    F251 : D1                  	POP	DE
     800/    F252 : C1                  	POP	BC
     801/    F253 : DD E1               	POP	IX
     802/    F255 : C9                  	RET
     803/    F256 :                     
     804/    F256 : [753]               	ENDIF
     805/    F256 :                     ;
     806/    F256 :                     ;-------------------------------------------------------------------------------
     807/    F256 :                     ;Ausgabe Zeichen auf Bildschirm
     808/    F256 :                     ;-------------------------------------------------------------------------------
     809/    F256 :                     ;
     810/    F256 :                     ; Zeichenausgabe f. PRST7: Reset Bit 7
     811/    F256 : E6 7F               OUT0:	AND	A, 7FH
     812/    F258 :                     ; Zeichenausgabe
     813/    F258 : F5                  OUTCH:	push	af
     814/    F259 : C5                  	push	bc
     815/    F25A : D5                  	push	de
     816/    F25B : E5                  	PUSH	HL
     817/    F25C : 2A 2B 00            	LD	HL,(CUPOS)
     818/    F25F : F5                  	PUSH	AF
     819/    F260 : 3A 1F 00            	LD	A,(BUFFA)		;Zeichen unter Cursor
     820/    F263 : 77                  	LD	(HL),A			;zurueckschreiben
     821/    F264 : F1                  	POP	AF
     822/    F265 : FE 0D               	CP	A, CR			;neue Zeile?
     823/    F267 : 28 53               	JR	Z, OUT8
     824/    F269 : FE 0C               	CP	A, CLS			;Bildschirm loeschen?
     825/    F26B : 28 5E               	JR	Z, OUT10
     826/    F26D : FE 08               	CP	A, 8			;Cursor links?
     827/    F26F : 28 48               	JR	Z, OUT7
     828/    F271 : FE 09               	CP	A, 9			;Cursor rechts?
     829/    F273 : 28 01               	JR	Z, OUT2
     830/    F275 : 77                  	LD	(HL),A			;sonst Zeichen in BWS
     831/    F276 : 23                  OUT2:	INC	HL
     832/    F277 :                     ;
     833/    F277 : EB                  OUT3:	EX	DE,HL
     834/    F278 : 2A 3D 00            	LD	HL,(WINDE)
     835/    F27B : AF                  	XOR	A			;Test, ob neue Cursor-
     836/    F27C : ED 52               	SBC	HL,DE			;position schon
     837/    F27E : EB                  	EX	DE,HL			;ausserhalb Window
     838/    F27F : 20 2A               	JR	NZ, OUT6		;nein
     839/    F281 :                     ;
     840/    F281 : ED 5B 3B 00         	LD	DE,(WINDA)		;scrollen um
     841/    F285 : 21 20 00            	LD	HL,BWSCOL		;eine Zeile im Window
     842/    F288 : 19                  	ADD	HL,DE
     843/    F289 : ED 4B 35 00         	LD	BC,(WINDL)		;Windowlaenge
     844/    F28D : 78                  	LD	A,B
     845/    F28E : B1                  	OR	C			;=0?
     846/    F28F : 28 02               	JR	Z, OUT5			;ja --> kein Scrollen
     847/    F291 : ED B0               	LDIR
     848/    F293 : D5                  OUT5:	PUSH	DE			;letzte Zeile loeschen
     849/    F294 : E1                  	POP	HL
     850/    F295 : E5                  	PUSH	HL
     851/    F296 : 13                  	INC	DE
     852/    F297 : 36 20               	LD	(HL),' '
     853/    F299 : 01 1F 00            	LD	BC,BWSCOL-1
     854/    F29C : ED B0               	LDIR
     855/    F29E :                     ;
     856/    F29E : 2A 16 00            	LD	HL,(SOIL)		;SOIL um eine Zeile
     857/    F2A1 : 11 20 00            	LD	DE,BWSCOL		;erhoehen
     858/    F2A4 : AF                  	XOR	A
     859/    F2A5 : ED 52               	SBC	HL,DE
     860/    F2A7 : 22 16 00            	LD	(SOIL),HL
     861/    F2AA : E1                  	POP	HL
     862/    F2AB :                     ;
     863/    F2AB : 7E                  OUT6:	LD	A,(HL)			;Zeichen unter Cursor
     864/    F2AC : 32 1F 00            	LD	(BUFFA),A		;sichern
     865/    F2AF : 36 FF               	LD	(HL),0FFH		;Cursor setzen
     866/    F2B1 : 22 2B 00            	LD	(CUPOS),HL
     867/    F2B4 : E1                  	POP	HL
     868/    F2B5 : D1                  	POP	DE
     869/    F2B6 : C1                  	POP	BC
     870/    F2B7 : F1                  	POP	AF
     871/    F2B8 : C9                  	RET
     872/    F2B9 :                     ;Cursor links
     873/    F2B9 : 2B                  OUT7:	DEC	HL
     874/    F2BA : 18 BB               	JR	OUT3
     875/    F2BC :                     ;neue Zeile
     876/    F2BC : 3E E0               OUT8:	LD	A, 0E0H			;auf Zeilenanfang stellen
     877/    F2BE : A5                  	AND	A, L			;A=Anfang akt. Zeile
     878/    F2BF : C6 20               	ADD	A, BWSCOL		;A=NWB der Position
     879/    F2C1 : 4F                  	LD	C,A			;eine Zeile tiefer
     880/    F2C2 : 36 20               OUT9:	LD	(HL),' '		;Rest der Zeile ab
     881/    F2C4 : 23                  	INC	HL			;ENTER loeschen
     882/    F2C5 : 7D                  	LD	A,L
     883/    F2C6 : B9                  	CP	A, C
     884/    F2C7 : 20 F9               	JR	NZ, OUT9
     885/    F2C9 : 18 AC               	JR	OUT3
     886/    F2CB :                     ;
     887/    F2CB :                     ;Window loeschen
     888/    F2CB : 2A 35 00            OUT10:	LD	HL,(WINDL)
     889/    F2CE : 01 1F 00            	LD	BC,BWSCOL-1
     890/    F2D1 : 09                  	ADD	HL,BC
     891/    F2D2 : E5                  	PUSH	HL
     892/    F2D3 : C1                  	POP	BC
     893/    F2D4 : 2A 3B 00            	LD	HL,(WINDA)
     894/    F2D7 : E5                  	PUSH	HL
     895/    F2D8 : 36 20               	LD	(HL),' '
     896/    F2DA : E5                  	PUSH	HL
     897/    F2DB : D1                  	POP	DE
     898/    F2DC : 13                  	INC	DE
     899/    F2DD : ED B0               	LDIR
     900/    F2DF : E1                  	POP	HL
     901/    F2E0 : 18 C9               	JR	OUT6
     902/    F2E2 :                     ;
     903/    F2E2 :                     ;-------------------------------------------------------------------------------
     904/    F2E2 :                     ;Ausgabe String, bis Bit7=1
     905/    F2E2 :                     ;-------------------------------------------------------------------------------
     906/    F2E2 :                     ;
     907/    F2E2 : E3                  PRST7:	EX	(SP),HL			;Adresse hinter CALL
     908/    F2E3 : 7E                  PRS1:	LD	A,(HL)
     909/    F2E4 : 23                  	INC	HL
     910/    F2E5 : F5                  	PUSH	AF
     911/    F2E6 : CD 56 F2            	CALL	OUT0
     912/    F2E9 : F1                  	POP	AF
     913/    F2EA : CB 7F               	BIT	7,A			;Bit7 gesetzt?
     914/    F2EC : 28 F5               	JR	Z, PRS1			;nein
     915/    F2EE : E3                  	EX	(SP),HL			;neue Returnadresse
     916/    F2EF : C9                  	RET
     917/    F2F0 :                     ;
     918/    F2F0 :                     ;-------------------------------------------------------------------------------
     919/    F2F0 :                     ;Eingabe einer Zeile mit Promptsymbol
     920/    F2F0 :                     ;-------------------------------------------------------------------------------
     921/    F2F0 :                     ;
     922/    F2F0 : CD E2 F2            INLIN:	CALL	PRST7
     923/    F2F3 : 20 23               	DB	" #"
     924/    F2F5 : A0                  	DB	' '+80H
     925/    F2F6 :                     ;
     926/    F2F6 :                     ;-------------------------------------------------------------------------------
     927/    F2F6 :                     ;Eingabe einer Zeichenkette
     928/    F2F6 :                     ;-------------------------------------------------------------------------------
     929/    F2F6 :                     ;
     930/    F2F6 : E5                  INSTR:	PUSH	HL
     931/    F2F7 : 2A 2B 00            	LD	HL,(CUPOS)
     932/    F2FA : 22 16 00            	LD	(SOIL),HL		;SOIL=1.Position
     933/    F2FD : (MACRO)             INS1:	RINCH				;Zeichen von Tastatur
     933/    F2FD : E7                          RST     20H
     933/    F2FE : 01                          DB      01h                     ; INCH
     934/    F2FF : (MACRO)             	ROUTC				;anzeigen
     934/    F2FF : E7                          RST     20H
     934/    F300 : 00                          DB      0                       ; OUTCH
     935/    F301 : FE 0D               	CP	A, CR			;>ENTER<?
     936/    F303 : 20 F8               	JR	NZ, INS1		;nein --> weiter eingeben
     937/    F305 : E1                  	POP	HL
     938/    F306 : C9                  	RET
     939/    F307 :                     ;
     940/    F307 :                     ;-------------------------------------------------------------------------------
     941/    F307 :                     ;fuehrende Leerzeichen ueberlesen
     942/    F307 :                     ;-------------------------------------------------------------------------------
     943/    F307 :                     ;
     944/    F307 : 1A                  SPACE:	LD	A,(DE)
     945/    F308 : FE 20               	CP	A, ' '
     946/    F30A : C0                  	RET	NZ
     947/    F30B : 13                  	INC	DE
     948/    F30C : 18 F9               	JR	SPACE
     949/    F30E :                     ;
     950/    F30E :                     ;-------------------------------------------------------------------------------
     951/    F30E :                     ;letzen vier Zeichen als Hexzahl konvertieren
     952/    F30E :                     ;und in DATA ablegen
     953/    F30E :                     ;-------------------------------------------------------------------------------
     954/    F30E :                     ;
     955/    F30E : CD 07 F3            KONVX:	CALL	SPACE
     956/    F311 : AF                  	XOR	A
     957/    F312 : 21 13 00            	LD	HL,DATA
     958/    F315 : 77                  	LD	(HL),A			;DATA=0
     959/    F316 : 23                  	INC	HL
     960/    F317 : 77                  	LD	(HL),A
     961/    F318 : 1A                  KON1:	LD	A,(DE)
     962/    F319 : 2B                  	DEC	HL
     963/    F31A : D6 30               	SUB	30H			;Zeichen<"0"?
     964/    F31C : F8                  	RET	M
     965/    F31D : FE 0A               	CP	A, 0AH			;Zeichen<="9"?
     966/    F31F : 38 08               	JR	C, KON2
     967/    F321 : D6 07               	SUB	7
     968/    F323 : FE 0A               	CP	A, 0AH			;Zeichen<"A"?
     969/    F325 : F8                  	RET	M
     970/    F326 : FE 10               	CP	A, 10H			;Zeichen>"F"?
     971/    F328 : F0                  	RET	P
     972/    F329 : 13                  KON2:	INC	DE			;Hexziffer eintragen
     973/    F32A : ED 6F               	RLD
     974/    F32C : 23                  	INC	HL
     975/    F32D : ED 6F               	RLD
     976/    F32F : 18 E7               	JR	KON1			;naechste Ziffer
     977/    F331 :                     ;
     978/    F331 :                     ;-------------------------------------------------------------------------------
     979/    F331 :                     ;Konvertierung ASCII-Hex ab (DE) --> (HL)
     980/    F331 :                     ;-------------------------------------------------------------------------------
     981/    F331 :                     ;
     982/    F331 : C5                  INHEX:	PUSH	BC
     983/    F332 : CD 0E F3            	CALL	KONVX			;Konvertierung
     984/    F335 : 44                  	LD	B,H			;BC=HL=DATA+1
     985/    F336 : 4D                  	LD	C,L
     986/    F337 : 6E                  	LD	L,(HL)			;unteres Byte
     987/    F338 : 03                  	INC	BC
     988/    F339 : 0A                  	LD	A,(BC)
     989/    F33A : 67                  	LD	H,A			;oberes Byte
     990/    F33B : B5                  	OR	L			;Z-Flag setzen
     991/    F33C : C1                  	POP	BC
     992/    F33D : C9                  	RET
     993/    F33E :                     ;
     994/    F33E :                     ;-------------------------------------------------------------------------------
     995/    F33E :                     ;Ausgabe (A) hexadezimal
     996/    F33E :                     ;-------------------------------------------------------------------------------
     997/    F33E :                     ;
     998/    F33E : F5                  OUTHX:	PUSH	AF
     999/    F33F : 1F                  	RRA
    1000/    F340 : 1F                  	RRA
    1001/    F341 : 1F                  	RRA
    1002/    F342 : 1F                  	RRA
    1003/    F343 : CD 47 F3            	CALL	OUX1			;obere Tetrade ausgeben
    1004/    F346 : F1                  	POP	AF			;und die untere
    1005/    F347 : F5                  OUX1:	PUSH	AF
    1006/    F348 : E6 0F               	AND	A, 0FH
    1007/    F34A : C6 30               	ADD	A, 30H			;Konvertierung --> ASCII
    1008/    F34C : FE 3A               	CP	A, ':'			;Ziffer "A" ... "F"?
    1009/    F34E : 38 02               	JR	C, OUX2			;nein
    1010/    F350 : C6 07               	ADD	A, 7			;sonst Korrektur
    1011/    F352 : CD 58 F2            OUX2:	CALL	OUTCH			;und Ausgabe
    1012/    F355 : F1                  	POP	AF
    1013/    F356 : C9                  	RET
    1014/    F357 :                     ;
    1015/    F357 :                     ;-------------------------------------------------------------------------------
    1016/    F357 :                     ;Ausgabe HL hexadezimal
    1017/    F357 :                     ;-------------------------------------------------------------------------------
    1018/    F357 :                     ;
    1019/    F357 : F5                  OUTHL:	PUSH	AF
    1020/    F358 : 7C                  	LD	A,H
    1021/    F359 : CD 3E F3            	CALL	OUTHX
    1022/    F35C : 7D                  	LD	A,L
    1023/    F35D : CD 3E F3            	CALL	OUTHX
    1024/    F360 : F1                  	POP	AF
    1025/    F361 : C9                  	RET
    1026/    F362 :                     ;
    1027/    F362 :                     ;-------------------------------------------------------------------------------
    1028/    F362 :                     ;Speicherinhalt modifizieren
    1029/    F362 :                     ;-------------------------------------------------------------------------------
    1030/    F362 :                     ;
    1031/    F362 : 2A 1B 00            MEM:	LD	HL,(ARG1)
    1032/    F365 : (MACRO)             MEM1:	ROTHL				;Ausgabe Adresse
    1032/    F365 : E7                          RST     20H
    1032/    F366 : 07                          DB      07h                     ; OUTHL
    1033/    F367 : E5                  	PUSH	HL
    1034/    F368 : (MACRO)             	ROTSP				;Leerzeichen
    1034/    F368 : E7                          RST     20H
    1034/    F369 : 0E                          DB      0Eh                     ; OUTSP
    1035/    F36A : 7E                  	LD	A,(HL)
    1036/    F36B : (MACRO)             	ROTHX				;Ausgabe Byte
    1036/    F36B : E7                          RST     20H
    1036/    F36C : 06                          DB      06h                     ; OUTHX
    1037/    F36D : CD F0 F2            	CALL	INLIN
    1038/    F370 : ED 5B 16 00         	LD	DE,(SOIL)
    1039/    F374 : 1A                  	LD	A,(DE)
    1040/    F375 : 08                  	EX	AF, AF'
    1041/    F376 : E1                  	POP	HL
    1042/    F377 : 2B                  	DEC	HL
    1043/    F378 : 23                  MEM2:	INC	HL
    1044/    F379 : E5                  	PUSH	HL
    1045/    F37A : CD 31 F3            	CALL	INHEX
    1046/    F37D : 28 0D               	JR	Z, MEM4			;Trennzeichen
    1047/    F37F : 7D                  MEM3:	LD	A,L
    1048/    F380 : E1                  	POP	HL
    1049/    F381 : 77                  	LD	(HL),A
    1050/    F382 : BE                  	CP	A, (HL)			;RAM-Test
    1051/    F383 : 28 F3               	JR	Z, MEM2			;i.O.
    1052/    F385 : (MACRO)             	RPRST
    1052/    F385 : E7                          RST     20H
    1052/    F386 : 02                          DB      02h                     ; PRST
    1053/    F387 : 45 52               	DB	"ER"
    1054/    F389 : A0                  	DB	' '+80H
    1055/    F38A : 18 D9               	JR	MEM1
    1056/    F38C :                     ;
    1057/    F38C : 1A                  MEM4:	LD	A,(DE)			;Test Datenbyte=0
    1058/    F38D : FE 20               	CP	A, ' '			;wenn ja --> Z=1
    1059/    F38F : 28 EE               	JR	Z, MEM3
    1060/    F391 : E1                  	POP	HL
    1061/    F392 : 23                  	INC	HL
    1062/    F393 : 22 1D 00            	LD	(ARG2),HL		;1. nichtbearb. Adr.
    1063/    F396 : FE 3B               	CP	A, ';'
    1064/    F398 : C8                  	RET	Z			;Return, wenn ";" gegeben
    1065/    F399 : 08                  	EX	AF, AF'
    1066/    F39A : FE 20               	CP	A, ' '
    1067/    F39C : 28 C7               	JR	Z, MEM1			;Z=1 keine Eingabe
    1068/    F39E : 2B                  	DEC	HL
    1069/    F39F : FE 52               	CP	A, 'R'			;"R" gegeben?
    1070/    F3A1 : 20 C2               	JR	NZ, MEM1		;nein
    1071/    F3A3 : 2B                  	DEC	HL			;sonst eine Adresse
    1072/    F3A4 : 18 BF               	JR	MEM1			;zurueck
    1073/    F3A6 :                     ;
    1074/    F3A6 :                     ;-------------------------------------------------------------------------------
    1075/    F3A6 :                     ;Speichern auf Kassette
    1076/    F3A6 :                     ;-------------------------------------------------------------------------------
    1077/    F3A6 :                     ;
    1078/    F3A6 : 2A 1B 00            CSAVE:	LD	HL,(ARG1)
    1079/    F3A9 : CD BA F3            	CALL	SAV2			;Ausgabe 20H Bytes
    1080/    F3AC : EB                  SAV1:	EX	DE,HL
    1081/    F3AD : 2A 1D 00            	LD	HL,(ARG2)
    1082/    F3B0 : A7                  	AND	A, A
    1083/    F3B1 : ED 52               	SBC	HL,DE
    1084/    F3B3 : EB                  	EX	DE,HL
    1085/    F3B4 : D8                  	RET	C			;wenn File zu Ende
    1086/    F3B5 : CD C0 F3            	CALL	SAV3			;Ausgabe 20H Byte
    1087/    F3B8 : 18 F2               	JR	SAV1
    1088/    F3BA :                     ;
    1089/    F3BA : ED 5B 33 00         SAV2:	LD	DE,(LSYNC)		;langer Vorton
    1090/    F3BE : 18 03               	JR	SAV4
    1091/    F3C0 :                     ;Ausgabe ein Block = 20H Bytes
    1092/    F3C0 : 11 0E 00            SAV3:	LD	DE,14			;kurzer Vorton
    1093/    F3C3 :                     ;Vorton: DE Halbschwingungen a 640 Hz
    1094/    F3C3 : 06 70               SAV4:	LD	B,70H			;Ausg. Vorton
    1095/    F3C5 : 10 FE               SAV5:	DJNZ	SAV5
    1096/    F3C7 : CD 2E F4            	CALL	SAV21			;Flanke wechseln
    1097/    F3CA : 1B                  	DEC	DE
    1098/    F3CB : 7B                  	LD	A,E
    1099/    F3CC : B2                  	OR	D
    1100/    F3CD : 20 F4               	JR	NZ,SAV4
    1101/    F3CF :                     ;Trennschwingung: 1 Vollschwingung a 1280 Hz	
    1102/    F3CF : 0E 02               	LD	C,02H			;Ausgabe Synchron-
    1103/    F3D1 : 06 35               SAV6:	LD	B,35H			;impulse
    1104/    F3D3 : 10 FE               SAV7:	DJNZ	SAV7
    1105/    F3D5 : CD 2E F4            	CALL	SAV21			;Flanke wechseln
    1106/    F3D8 : 0D                  	DEC	C
    1107/    F3D9 : 11 00 00            	LD	DE,0
    1108/    F3DC : 20 F3               	JR	NZ,SAV6
    1109/    F3DE :                     ;
    1110/    F3DE : D5                  	PUSH	DE			;DE=IX=0000
    1111/    F3DF : DD E1               	POP	IX
    1112/    F3E1 :                     ;Kopfinhalt ausgeben
    1113/    F3E1 : 06 12               	LD	B,12H			;kurze Pause
    1114/    F3E3 : 10 FE               SAV8:	DJNZ	SAV8
    1115/    F3E5 : CD 0D F4            	CALL	SAV14			;Ausgabe DE
    1116/    F3E8 : 06 0F               	LD	B,0FH			;kurze Pause
    1117/    F3EA : 10 FE               SAV9:	DJNZ	SAV9
    1118/    F3EC :                     ;20H Bytes ausgeben
    1119/    F3EC : 0E 10               	LD	C,10H			;10H*2 Bytes
    1120/    F3EE : 5E                  SAV10:	LD	E,(HL)
    1121/    F3EF : 23                  	INC	HL
    1122/    F3F0 : 56                  	LD	D,(HL)
    1123/    F3F1 : DD 19               	ADD	IX,DE			;Pruefsumme bilden
    1124/    F3F3 : 23                  	INC	HL
    1125/    F3F4 : C5                  	PUSH	BC
    1126/    F3F5 : CD 0D F4            	CALL	SAV14			;Ausgabe DE
    1127/    F3F8 : C1                  	POP	BC
    1128/    F3F9 : 0D                  	DEC	C
    1129/    F3FA : 28 06               	JR	Z, SAV12		;Block fertig geschrieben
    1130/    F3FC : 06 0E               	LD	B,0EH			;kurze Pause
    1131/    F3FE : 10 FE               SAV11:	DJNZ	SAV11
    1132/    F400 : 18 EC               	JR	SAV10
    1133/    F402 :                     ;Pruefsumme ausgeben
    1134/    F402 : DD E5               SAV12:	PUSH	IX
    1135/    F404 : D1                  	POP	DE			;DE = Pruefsumme
    1136/    F405 : 06 10               	LD	B,10H			;kurze Pause
    1137/    F407 : 10 FE               SAV13:	DJNZ	SAV13			
    1138/    F409 : CD 0D F4            	CALL	SAV14			;DE ausgeben
    1139/    F40C : C9                  	RET
    1140/    F40D :                     ;Ausgabe 16 Bit DE
    1141/    F40D : 0E 10               SAV14:	LD	C,16			;16 Bit
    1142/    F40F : CB 3A               SAV15:	SRL	D			;Hi-Bit in Cy schieben
    1143/    F411 : CB 1B               	RR	E
    1144/    F413 : 30 07               	JR	NC, SAV17		;Cy=1, wenn Bit=1
    1145/    F415 :                     ;1-Bit 1 Halbschwingung mit 1280 Hz 
    1146/    F415 : 06 03               	LD	B,3
    1147/    F417 : 10 FE               SAV16:	DJNZ	SAV16
    1148/    F419 : 00                  	NOP
    1149/    F41A : 18 03               	JR	SAV18
    1150/    F41C :                     ;0-Bit 1 Vollschwingung mit 2560 Hz 
    1151/    F41C : CD 2E F4            SAV17:	CALL	SAV21			;Flanke ausgeben
    1152/    F41F : 06 19               SAV18:	LD	B,19H
    1153/    F421 : 10 FE               SAV19:	DJNZ	SAV19
    1154/    F423 : CD 2E F4            	CALL	SAV21			;Flanke ausgeben
    1155/    F426 : 0D                  	DEC	C
    1156/    F427 : C8                  	RET	Z			;wenn fertig
    1157/    F428 : 06 15               	LD	B,15H
    1158/    F42A : 10 FE               SAV20:	DJNZ	SAV20
    1159/    F42C : 18 E1               	JR	SAV15
    1160/    F42E :                     ;Flanke ausgeben
    1161/    F42E : DB 02               SAV21:	IN	A, PIOBD		;Flanke ausgeben
    1162/    F430 : EE 80               	XOR	80H			;durch Bit-Negierung Bit7
    1163/    F432 : D3 02               	OUT	PIOBD, A
    1164/    F434 : C9                  	RET
    1165/    F435 :                     ;
    1166/    F435 :                     ;-------------------------------------------------------------------------------
    1167/    F435 :                     ;Laden von Kassette
    1168/    F435 :                     ;-------------------------------------------------------------------------------
    1169/    F435 :                     ;
    1170/    F435 : 2A 1B 00            CLOAD:	LD	HL,(ARG1)
    1171/    F438 : CD 54 F4            LOA1:	CALL	LOA3			;laden 20H Bytes
    1172/    F43B : 28 0C               	JR	Z, LOA2			;wenn kein Ladefehler
    1173/    F43D : CD E2 F2            	CALL	PRST7			;sonst Fehler
    1174/    F440 : 43 53               	DB	"CS"
    1175/    F442 : BC                  	DB	'<'+80h
    1176/    F443 : CD 57 F3            	CALL	OUTHL			;Adresse ausgeben
    1177/    F446 : CD 0C F6            	CALL	OUTSP
    1178/    F449 : EB                  LOA2:	EX	DE,HL
    1179/    F44A : 2A 1D 00            	LD	HL,(ARG2)
    1180/    F44D : A7                  	AND	A, A
    1181/    F44E : ED 52               	SBC	HL,DE			;Endadresse erreicht?
    1182/    F450 : EB                  	EX	DE,HL
    1183/    F451 : D8                  	RET	C			;ja --> fertig
    1184/    F452 : 18 E4               	JR	LOA1			;sonst weiterlesen
    1185/    F454 :                     ;20H Bytes laden nach (HL)
    1186/    F454 : CD F9 F4            LOA3:	CALL	LOA24			;synchronisieren
    1187/    F457 : CD 03 F5            	CALL	LOA25			;Flanke abwarten
    1188/    F45A : 0E 07               	LD	C,7
    1189/    F45C : 11 10 09            LOA5:	LD	DE,0910H		;D=9, E=10h
    1190/    F45F : 3E 07               	LD	A,7
    1191/    F461 : 3D                  LOA6:	DEC	A
    1192/    F462 : 20 FD               	JR	NZ, LOA6
    1193/    F464 : CD F9 F4            	CALL	LOA24			;synchronisieren
    1194/    F467 : CD F9 F4            LOA7:	CALL	LOA24			;Flanke ?
    1195/    F46A : 20 E8               	JR	NZ, LOA3		;wenn nicht Vorton
    1196/    F46C : 15                  	DEC	D
    1197/    F46D : 20 F8               	JR	NZ, LOA7
    1198/    F46F : 0D                  	DEC	C
    1199/    F470 : 28 0C               	JR	Z, LOA9
    1200/    F472 : DB 02               LOA8:	IN	A, 2
    1201/    F474 : A8                  	XOR	B
    1202/    F475 : CB 77               	BIT	6,A
    1203/    F477 : 20 E3               	JR	NZ, LOA5
    1204/    F479 : 1D                  	DEC	E
    1205/    F47A : 20 F6               	JR	NZ, LOA8
    1206/    F47C : 18 D6               	JR	LOA3
    1207/    F47E :                     ;Synchronisierimpulse lesen
    1208/    F47E : CD 03 F5            LOA9:	CALL	LOA25			;Flanke abwarten
    1209/    F481 : 3E 44               	LD	A,44H
    1210/    F483 : 3D                  LOA10:	DEC	A
    1211/    F484 : 20 FD               	JR	NZ, LOA10
    1212/    F486 : CD F9 F4            	CALL	LOA24			;Flanke ?
    1213/    F489 : 20 F3               	JR	NZ, LOA9		;wenn nicht
    1214/    F48B : CD 03 F5            	CALL	LOA25			;Flanke abwarten
    1215/    F48E : 3E 1E               	LD	A,1EH
    1216/    F490 : 3D                  LOA11:	DEC	A
    1217/    F491 : 20 FD               	JR	NZ, LOA11
    1218/    F493 :                     ;2 Bytes Kopf lesen
    1219/    F493 : CD DA F4            	CALL	LOA19			;lesen DE
    1220/    F496 :                     ;20H Byte Daten lesen
    1221/    F496 : 0E 10               	LD	C,10H			;10H x 2 Bytes
    1222/    F498 : D5                  	PUSH	DE
    1223/    F499 : DD E1               	POP	IX			;IX-Pruefsummenzaehler=
    1224/    F49B : 3E 1A               	LD	A,1AH
    1225/    F49D : 3D                  LOA12:	DEC	A
    1226/    F49E : 20 FD               	JR	NZ, LOA12
    1227/    F4A0 : CD DA F4            LOA13:	CALL	LOA19			;laden DE
    1228/    F4A3 : DD 19               	ADD	IX,DE			;Pruefsumme bilden
    1229/    F4A5 : C5                  	PUSH	BC
    1230/    F4A6 : 4D                  	LD	C,L
    1231/    F4A7 : 44                  	LD	B,H
    1232/    F4A8 : 2A 1D 00            	LD	HL,(ARG2)
    1233/    F4AB : AF                  	XOR	A
    1234/    F4AC : ED 42               	SBC	HL,BC			;Endadresse erreicht?
    1235/    F4AE : 69                  	LD	L,C
    1236/    F4AF : 60                  	LD	H,B
    1237/    F4B0 : C1                  	POP	BC
    1238/    F4B1 : 38 05               	JR	C, LOA14		;ja --> Leseende
    1239/    F4B3 : 73                  	LD	(HL),E
    1240/    F4B4 : 23                  	INC	HL
    1241/    F4B5 : 72                  	LD	(HL),D
    1242/    F4B6 : 18 06               	JR	LOA16
    1243/    F4B8 : 3E 01               LOA14:	LD	A,1
    1244/    F4BA : 3D                  LOA15:	DEC	A
    1245/    F4BB : 20 FD               	JR	NZ, LOA15
    1246/    F4BD : 23                  	INC	HL
    1247/    F4BE : 23                  LOA16:	INC	HL
    1248/    F4BF : 0D                  	DEC	C
    1249/    F4C0 : 28 07               	JR	Z, LOA18		;wenn Blockende
    1250/    F4C2 : 3E 12               	LD	A,12H
    1251/    F4C4 : 3D                  LOA17:	DEC	A
    1252/    F4C5 : 20 FD               	JR	NZ, LOA17
    1253/    F4C7 : 18 D7               	JR	LOA13			;naechte 2 Byte
    1254/    F4C9 : 3E 12               LOA18:	LD	A,12H
    1255/    F4CB : 3D                  LOA27:	DEC	A
    1256/    F4CC : 20 FD               	JR	NZ, LOA27
    1257/    F4CE :                     ;Pruefsumme lesen	
    1258/    F4CE : CD DA F4            	CALL	LOA19			;laden DE
    1259/    F4D1 : EB                  	EX	DE,HL
    1260/    F4D2 : DD E5               	PUSH	IX
    1261/    F4D4 : C1                  	POP	BC
    1262/    F4D5 : AF                  	XOR	A
    1263/    F4D6 : ED 42               	SBC	HL,BC			;Prüfsumme gleich?
    1264/    F4D8 : EB                  	EX	DE,HL			;Z=0 Ladefehler
    1265/    F4D9 : C9                  	RET
    1266/    F4DA :                     ;Laden 2 Byte nach DE
    1267/    F4DA : E5                  LOA19:	PUSH	HL
    1268/    F4DB : 2E 10               	LD	L,10H			;16 Datenbits
    1269/    F4DD : CD F9 F4            LOA20:	CALL	LOA24			;Flanke ?
    1270/    F4E0 : 20 03               	JR	NZ, LOA21
    1271/    F4E2 : AF                  	XOR	A			;Cy=0
    1272/    F4E3 : 18 01               	JR	LOA22
    1273/    F4E5 : 37                  LOA21:	SCF
    1274/    F4E6 : CB 1A               LOA22:	RR	D
    1275/    F4E8 : CB 1B               	RR	E
    1276/    F4EA : CD 03 F5            	CALL	LOA25			;Flanke abwarten
    1277/    F4ED : 2D                  	DEC	L
    1278/    F4EE : 28 07               	JR	Z, LOA23		;wenn fertig
    1279/    F4F0 : 3E 1E               	LD	A,1EH
    1280/    F4F2 : 3D                  LOA26:	DEC	A
    1281/    F4F3 : 20 FD               	JR	NZ, LOA26
    1282/    F4F5 : 18 E6               	JR	LOA20
    1283/    F4F7 : E1                  LOA23:	POP	HL
    1284/    F4F8 : C9                  	RET
    1285/    F4F9 :                     ;Portabfrage
    1286/    F4F9 : DB 02               LOA24:	IN	A, PIOBD
    1287/    F4FB : A8                  	XOR	B
    1288/    F4FC : CB 77               	BIT	6,A			;Bit6->TB in
    1289/    F4FE : F5                  	PUSH	AF
    1290/    F4FF : A8                  	XOR	B
    1291/    F500 : 47                  	LD	B,A
    1292/    F501 : F1                  	POP	AF			;Z=0 --> Flanke
    1293/    F502 : C9                  	RET
    1294/    F503 :                     ;Warten auf Flankenwechsel
    1295/    F503 : DB 02               LOA25:	IN	A, PIOBD
    1296/    F505 : A8                  	XOR	B
    1297/    F506 : CB 77               	BIT	6,A			;Bit6->TB in
    1298/    F508 : 28 F9               	JR	Z, LOA25
    1299/    F50A : C9                  	RET
    1300/    F50B :                     ;
    1301/    F50B :                     ;-------------------------------------------------------------------------------
    1302/    F50B :                     ;Speicherinhalt mit Checksumme anzeigen
    1303/    F50B :                     ;-------------------------------------------------------------------------------
    1304/    F50B :                     ;
    1305/    F50B : 2A 1B 00            D_KDO:	LD	HL,(ARG1)
    1306/    F50E : ED 5B 1D 00         DKO1:	LD	DE,(ARG2)
    1307/    F512 : 37                  	SCF
    1308/    F513 : E5                  	PUSH	HL
    1309/    F514 : ED 52               	SBC	HL,DE
    1310/    F516 : E1                  	POP	HL
    1311/    F517 : D0                  	RET	NC			;wenn EADR<AADR
    1312/    F518 : (MACRO)             	ROTHL
    1312/    F518 : E7                          RST     20H
    1312/    F519 : 07                          DB      07h                     ; OUTHL
    1313/    F51A : 01 00 08            	LD	BC,0800H		;B=8
    1314/    F51D : 1E 00               	LD	E,0			;EC=0 - Checksumme
    1315/    F51F : (MACRO)             DKO2:	RPRST
    1315/    F51F : E7                          RST     20H
    1315/    F520 : 02                          DB      02h                     ; PRST
    1316/    F521 : A0                  	DB	' '+80H
    1317/    F522 : 7E                  	LD	A,(HL)
    1318/    F523 : (MACRO)             	ROTHX
    1318/    F523 : E7                          RST     20H
    1318/    F524 : 06                          DB      06h                     ; OUTHX
    1319/    F525 : 81                  	ADD	A, C			;Checksumme bilden
    1320/    F526 : 4F                  	LD	C,A
    1321/    F527 : 30 04               	JR	NC, DKO3
    1322/    F529 : 3E 00               	LD	A,0
    1323/    F52B : 8B                  	ADC	A, E
    1324/    F52C : 5F                  	LD	E,A
    1325/    F52D : 23                  DKO3:	INC	HL
    1326/    F52E : 10 EF               	DJNZ	DKO2
    1327/    F530 : (MACRO)             	RPRST
    1327/    F530 : E7                          RST     20H
    1327/    F531 : 02                          DB      02h                     ; PRST
    1328/    F532 : A0                  	DB	' '+80H
    1329/    F533 : 7B                  	LD	A,E
    1330/    F534 : CD 47 F3            	CALL	OUX1			;Checksumme ausgeben
    1331/    F537 : 79                  	LD	A,C
    1332/    F538 : (MACRO)             	ROTHX
    1332/    F538 : E7                          RST     20H
    1332/    F539 : 06                          DB      06h                     ; OUTHX
    1333/    F53A : 18 D2               	JR	DKO1
    1334/    F53C :                     ;
    1335/    F53C :                     ;-------------------------------------------------------------------------------
    1336/    F53C :                     ;Argumente uebergeben
    1337/    F53C :                     ;-------------------------------------------------------------------------------
    1338/    F53C :                     ;
    1339/    F53C : 2A 1B 00            PARA:	LD	HL,(ARG1)
    1340/    F53F : ED 5B 1D 00         	LD	DE,(ARG2)
    1341/    F543 : ED 4B 23 00         	LD	BC,(ARG3)
    1342/    F547 : C9                  	RET
    1343/    F548 :                     ;
    1344/    F548 :                     ;-------------------------------------------------------------------------------
    1345/    F548 :                     ;Speicherbereich mit Byte beschreiben
    1346/    F548 :                     ;-------------------------------------------------------------------------------
    1347/    F548 :                     ;
    1348/    F548 : CD 3C F5            K_KDO:	CALL	PARA
    1349/    F54B : 71                  	LD	(HL),C			;C=Fuellbyte
    1350/    F54C : E5                  	PUSH	HL
    1351/    F54D : AF                  	XOR	A
    1352/    F54E : EB                  	EX	DE,HL
    1353/    F54F : ED 52               	SBC	HL,DE
    1354/    F551 : 44                  	LD	B,H
    1355/    F552 : 4D                  	LD	C,L			;BC=Laenge
    1356/    F553 : E1                  	POP	HL
    1357/    F554 : 54                  	LD	D,H
    1358/    F555 : 5D                  	LD	E,L
    1359/    F556 : 13                  	INC	DE
    1360/    F557 : ED B0               	LDIR
    1361/    F559 : C9                  	RET
    1362/    F55A :                     ;
    1363/    F55A :                     ;-------------------------------------------------------------------------------
    1364/    F55A :                     ;Speicherbereich verschieben
    1365/    F55A :                     ;-------------------------------------------------------------------------------
    1366/    F55A :                     ;
    1367/    F55A : CD 3C F5            T_KDO:	CALL	PARA
    1368/    F55D : AF                  	XOR	A
    1369/    F55E : E5                  	PUSH	HL
    1370/    F55F : ED 52               	SBC	HL,DE
    1371/    F561 : E1                  	POP	HL
    1372/    F562 : 38 03               	JR	C, TKO1			;wenn Zieladr. groesser
    1373/    F564 : ED B0               	LDIR				;Vorwaertstransfer
    1374/    F566 : C9                  	RET
    1375/    F567 : 09                  TKO1:	ADD	HL,BC
    1376/    F568 : EB                  	EX	DE,HL
    1377/    F569 : 09                  	ADD	HL,BC
    1378/    F56A : EB                  	EX	DE,HL
    1379/    F56B : 2B                  	DEC	HL
    1380/    F56C : 1B                  	DEC	DE
    1381/    F56D : ED B8               	LDDR				;Rueckwaertstransfer
    1382/    F56F : C9                  	RET
    1383/    F570 :                     ;
    1384/    F570 :                     ;-------------------------------------------------------------------------------
    1385/    F570 :                     ;Debugging-Funktionen
    1386/    F570 :                     ;-------------------------------------------------------------------------------
    1387/    F570 :                     ;
    1388/    F570 :                     ;Register im Registerrettebereich ablegen
    1389/    F570 :                     ;
    1390/    F570 : ED 73 13 00         REGA:	LD	(DATA),SP
    1391/    F574 : 31 61 00            	LD	SP,REGPC
    1392/    F577 : DD E5               	PUSH	IX
    1393/    F579 : FD E5               	PUSH	IY
    1394/    F57B : F5                  	PUSH	AF
    1395/    F57C : C5                  	PUSH	BC
    1396/    F57D : D5                  	PUSH	DE
    1397/    F57E : E5                  	PUSH	HL
    1398/    F57F : D9                  	EXX
    1399/    F580 : 08                  	EX	AF, AF'
    1400/    F581 : F5                  	PUSH	AF
    1401/    F582 : C5                  	PUSH	BC
    1402/    F583 : D5                  	PUSH	DE
    1403/    F584 : E5                  	PUSH	HL
    1404/    F585 : 18 15               	JR	REG1
    1405/    F587 :                     ;Register aus Registerrettebereich holen
    1406/    F587 : ED 73 13 00         REGH:	LD	(DATA),SP
    1407/    F58B : 31 4D 00            	LD	SP,REGBR
    1408/    F58E : E1                  	POP	HL
    1409/    F58F : D1                  	POP	DE
    1410/    F590 : C1                  	POP	BC
    1411/    F591 : F1                  	POP	AF
    1412/    F592 : D9                  	EXX
    1413/    F593 : 08                  	EX	AF, AF'
    1414/    F594 : E1                  	POP	HL
    1415/    F595 : D1                  	POP	DE
    1416/    F596 : C1                  	POP	BC
    1417/    F597 : F1                  	POP	AF
    1418/    F598 : FD E1               	POP	IY
    1419/    F59A : DD E1               	POP	IX
    1420/    F59C : ED 7B 13 00         REG1:	LD	SP,(DATA)
    1421/    F5A0 : C9                  	RET
    1422/    F5A1 :                     ;
    1423/    F5A1 :                     ;Einsprung bei Breakpoint
    1424/    F5A1 :                     ;
    1425/    F5A1 : CD 70 F5            BREAK:	CALL	REGA			;Register ablegen
    1426/    F5A4 : E1                  	POP	HL			;HL=Breakadr.+3
    1427/    F5A5 : ED 73 63 00         	LD	(REGSP),SP		;SP sichern
    1428/    F5A9 : 31 B0 00            	LD	SP,SYSSK		;Systemstack nutzen
    1429/    F5AC : 2B                  	DEC	HL
    1430/    F5AD : 2B                  	DEC	HL
    1431/    F5AE : 2B                  	DEC	HL
    1432/    F5AF : 22 61 00            	LD	(REGPC),HL		;Breakadresse
    1433/    F5B2 : ED 5B 0B 00         	LD	DE,(BPADR)		;die originalen 3 Byte
    1434/    F5B6 : 21 0D 00            	LD	HL,BPOPC		;Operanden zurueckbringen
    1435/    F5B9 : 01 03 00            	LD	BC,3
    1436/    F5BC : ED B0               	LDIR
    1437/    F5BE : CD 21 F6            	CALL	REGDA
    1438/    F5C1 : C3 59 F0            	JP	KDO2
    1439/    F5C4 :                     ;
    1440/    F5C4 :                     ;-------------------------------------------------------------------------------
    1441/    F5C4 :                     ;Breakpoint-Adresse setzen
    1442/    F5C4 :                     ;-------------------------------------------------------------------------------
    1443/    F5C4 :                     ;
    1444/    F5C4 : 2A 1B 00            B_KDO:	LD	HL,(ARG1)
    1445/    F5C7 : 22 0B 00            	LD	(BPADR),HL
    1446/    F5CA : 11 0D 00            	LD	DE,BPOPC		;3 Byte Operanden
    1447/    F5CD : 01 03 00            	LD	BC,3			;retten
    1448/    F5D0 : ED B0               	LDIR
    1449/    F5D2 : CD 21 F6            	CALL	REGDA			;Register anzeigen
    1450/    F5D5 : C9                  	RET
    1451/    F5D6 :                     ;
    1452/    F5D6 :                     ;-------------------------------------------------------------------------------
    1453/    F5D6 :                     ;Programm starten mit Breakpoint
    1454/    F5D6 :                     ;-------------------------------------------------------------------------------
    1455/    F5D6 :                     ;
    1456/    F5D6 : 2A 0B 00            E_KDO:	LD	HL,(BPADR)
    1457/    F5D9 : 36 CD               	LD	(HL),0CDH		;CALL ...
    1458/    F5DB : 23                  	INC	HL
    1459/    F5DC : 11 A1 F5            	LD	DE,BREAK		;an Breakpoint Unter-
    1460/    F5DF : 73                  	LD	(HL),E			;Brechung zu BREAK eintragen
    1461/    F5E0 : 23                  	INC	HL
    1462/    F5E1 : 72                  	LD	(HL),D
    1463/    F5E2 :                     ;
    1464/    F5E2 :                     ;-------------------------------------------------------------------------------
    1465/    F5E2 :                     ;Programm starten
    1466/    F5E2 :                     ;-------------------------------------------------------------------------------
    1467/    F5E2 :                     ;
    1468/    F5E2 : 2A 1B 00            J_KDO:	LD	HL,(ARG1)		;Startadresse
    1469/    F5E5 : 22 61 00            	LD	(REGPC),HL		;zwischenspeichern
    1470/    F5E8 : ED 7B 63 00         	LD	SP,(REGSP)		;Stack generieren
    1471/    F5EC : E5                  	PUSH	HL			;Startadresse in Stack
    1472/    F5ED : C3 87 F5            	JP	REGH			;Register holen
    1473/    F5F0 :                     					;und Pgm. durch RET starten
    1474/    F5F0 :                     ;
    1475/    F5F0 :                     ;-------------------------------------------------------------------------------
    1476/    F5F0 :                     ;Programm nach Break fortsetzen
    1477/    F5F0 :                     ;-------------------------------------------------------------------------------
    1478/    F5F0 :                     ;
    1479/    F5F0 : 2A 61 00            G_KDO:	LD	HL,(REGPC)
    1480/    F5F3 : 22 1B 00            	LD	(ARG1),HL
    1481/    F5F6 : ED 5B 0B 00         	LD	DE,(BPADR)
    1482/    F5FA : AF                  	XOR	A			;Cy=0
    1483/    F5FB : ED 52               	SBC	HL,DE
    1484/    F5FD : 20 D7               	JR	NZ, E_KDO		;wenn nicht Breakpoint
    1485/    F5FF : 18 E1               	JR	J_KDO			;starten
    1486/    F601 :                     ;
    1487/    F601 :                     ;-------------------------------------------------------------------------------
    1488/    F601 :                     ;Ausgabe eines Doppelpunktes und (HL) und Leerzeichen
    1489/    F601 :                     ;-------------------------------------------------------------------------------
    1490/    F601 :                     ;
    1491/    F601 : (MACRO)             OUTDP:	RPRST
    1491/    F601 : E7                          RST     20H
    1491/    F602 : 02                          DB      02h                     ; PRST
    1492/    F603 : BA                  	DB	':'+80H
    1493/    F604 :                     ;
    1494/    F604 :                     ;-------------------------------------------------------------------------------
    1495/    F604 :                     ;Ausgabe hex 2 Byte Speicher (HL) und (HL-1)
    1496/    F604 :                     ;und ein Leerzeichen
    1497/    F604 :                     ;-------------------------------------------------------------------------------
    1498/    F604 :                     ;
    1499/    F604 : 7E                  OTHLS:	LD	A,(HL)			;hoeherwertiges Byte
    1500/    F605 : (MACRO)             	ROTHX				;ausgeben
    1500/    F605 : E7                          RST     20H
    1500/    F606 : 06                          DB      06h                     ; OUTHX
    1501/    F607 : 2B                  	DEC	HL
    1502/    F608 : 7E                  	LD	A,(HL)			;niederwertiges Byte
    1503/    F609 : (MACRO)             	ROTHX				;ausgeben
    1503/    F609 : E7                          RST     20H
    1503/    F60A : 06                          DB      06h                     ; OUTHX
    1504/    F60B : 2B                  	DEC	HL			;naechsten Aufruf vorbereiten
    1505/    F60C :                     ;
    1506/    F60C :                     ;-------------------------------------------------------------------------------
    1507/    F60C :                     ;Ausgabe ein Leerzeichen
    1508/    F60C :                     ;-------------------------------------------------------------------------------
    1509/    F60C :                     ;
    1510/    F60C : (MACRO)             OUTSP:	RPRST
    1510/    F60C : E7                          RST     20H
    1510/    F60D : 02                          DB      02h                     ; PRST
    1511/    F60E : A0                  	DB	' '+80H
    1512/    F60F : C9                  	RET
    1513/    F610 :                     ;
    1514/    F610 :                     ;-------------------------------------------------------------------------------
    1515/    F610 :                     ;Registermodifizerung und -anzeige
    1516/    F610 :                     ;-------------------------------------------------------------------------------
    1517/    F610 :                     ;
    1518/    F610 :                     ;Z-Flag-Anzeige
    1519/    F610 :                     ;
    1520/    F610 : (MACRO)             AUS1:	RPRST				;Ausg. "1 "
    1520/    F610 : E7                          RST     20H
    1520/    F611 : 02                          DB      02h                     ; PRST
    1521/    F612 : 31                  	DB	"1"
    1522/    F613 : A0                  	DB	' '+80H
    1523/    F614 : C9                  	RET
    1524/    F615 : 20 F9               AUSX:	JR	NZ, AUS1
    1525/    F617 : (MACRO)             	RPRST				;Ausg. "0 "
    1525/    F617 : E7                          RST     20H
    1525/    F618 : 02                          DB      02h                     ; PRST
    1526/    F619 : 30                  	DB	"0"
    1527/    F61A : A0                  	DB	' '+80H
    1528/    F61B : C9                  	RET
    1529/    F61C :                     ;
    1530/    F61C :                     ; R-Kommando
    1531/    F61C :                     ;
    1532/    F61C : FE 3A               R_KDO:	CP	A, ':'
    1533/    F61E : C2 97 F6            	JP	NZ, RKO3		;wenn Modifizierung
    1534/    F621 :                     ;
    1535/    F621 : (MACRO)             REGDA:	RPRST				;Anzeige Breakpointadresse
    1535/    F621 : E7                          RST     20H
    1535/    F622 : 02                          DB      02h                     ; PRST
    1536/    F623 : 0D                  	DB	CR
    1537/    F624 : 42                  	DB	"B"			;"BP"
    1538/    F625 : D0                  	DB	'P'+80H
    1539/    F626 : 21 0C 00            	LD	HL,BPADR+1
    1540/    F629 : (MACRO)             	ROTDP
    1540/    F629 : E7                          RST     20H
    1540/    F62A : 0D                          DB      0Dh                     ; OUTDP
    1541/    F62B : (MACRO)             	RPRST				;Ausgabe Operandenfolge
    1541/    F62B : E7                          RST     20H
    1541/    F62C : 02                          DB      02h                     ; PRST
    1542/    F62D : 42 53               	DB	"BS"			;am Breakpoint
    1543/    F62F : BA                  	DB	':'+80H
    1544/    F630 : 06 03               	LD	B,3			;3 Byte
    1545/    F632 : 21 0D 00            	LD	HL,BPOPC
    1546/    F635 : 7E                  RKO1:	LD	A,(HL)
    1547/    F636 : (MACRO)             	ROTHX
    1547/    F636 : E7                          RST     20H
    1547/    F637 : 06                          DB      06h                     ; OUTHX
    1548/    F638 : 23                  	INC	HL
    1549/    F639 : 10 FA               	DJNZ	RKO1
    1550/    F63B :                     ;
    1551/    F63B : (MACRO)             	RPRST				;Flaganzeige
    1551/    F63B : E7                          RST     20H
    1551/    F63C : 02                          DB      02h                     ; PRST
    1552/    F63D : 20 20 20 53 20 5A   	DB	"   S Z C"
                    20 43 
    1553/    F645 : A0                  	DB	' '+80H
    1554/    F646 : 3A 5B 00            	LD	A,(REGAF)		;A-Flagregister
    1555/    F649 : 6F                  	LD	L,A
    1556/    F64A : CB 7D               	BIT	7,L			;S-Flag
    1557/    F64C : CD 15 F6            	CALL	AUSX
    1558/    F64F : CB 75               	BIT	6,L			;Z-Flag
    1559/    F651 : CD 15 F6            	CALL	AUSX
    1560/    F654 : CB 45               	BIT	0,L			;Cy-Flag
    1561/    F656 : CD 15 F6            	CALL	AUSX
    1562/    F659 :                     ;
    1563/    F659 : 21 64 00            	LD	HL,REGSP+1		;Sonderregister-anzeige
    1564/    F65C : 06 02               	LD	B,2			;2 Registersaetze
    1565/    F65E : (MACRO)             	RPRST
    1565/    F65E : E7                          RST     20H
    1565/    F65F : 02                          DB      02h                     ; PRST
    1566/    F660 : 53                  RKO2:	DB	"S"
    1567/    F661 : D0                  	DB	'P'+80H
    1568/    F662 : (MACRO)             	ROTDP
    1568/    F662 : E7                          RST     20H
    1568/    F663 : 0D                          DB      0Dh                     ; OUTDP
    1569/    F664 : (MACRO)             	RPRST
    1569/    F664 : E7                          RST     20H
    1569/    F665 : 02                          DB      02h                     ; PRST
    1570/    F666 : 50                  	DB	"P"
    1571/    F667 : C3                  	DB	'C'+80H
    1572/    F668 : (MACRO)             	ROTDP
    1572/    F668 : E7                          RST     20H
    1572/    F669 : 0D                          DB      0Dh                     ; OUTDP
    1573/    F66A : (MACRO)             	RPRST
    1573/    F66A : E7                          RST     20H
    1573/    F66B : 02                          DB      02h                     ; PRST
    1574/    F66C : 49                  	DB	"I"
    1575/    F66D : D8                  	DB	'X'+80H
    1576/    F66E : (MACRO)             	ROTDP
    1576/    F66E : E7                          RST     20H
    1576/    F66F : 0D                          DB      0Dh                     ; OUTDP
    1577/    F670 : (MACRO)             	RPRST
    1577/    F670 : E7                          RST     20H
    1577/    F671 : 02                          DB      02h                     ; PRST
    1578/    F672 : 49                  	DB	"I"
    1579/    F673 : D9                  	DB	'Y'+80H
    1580/    F674 : (MACRO)             	ROTDP
    1580/    F674 : E7                          RST     20H
    1580/    F675 : 0D                          DB      0Dh                     ; OUTDP
    1581/    F676 :                     ;
    1582/    F676 : (MACRO)             RKO4:	RPRST				;Registersatz anzeigen
    1582/    F676 : E7                          RST     20H
    1582/    F677 : 02                          DB      02h                     ; PRST
    1583/    F678 : 41                  	DB	"A"
    1584/    F679 : C6                  	DB	'F'+80H
    1585/    F67A : (MACRO)             	ROTDP
    1585/    F67A : E7                          RST     20H
    1585/    F67B : 0D                          DB      0Dh                     ; OUTDP
    1586/    F67C : (MACRO)             	RPRST
    1586/    F67C : E7                          RST     20H
    1586/    F67D : 02                          DB      02h                     ; PRST
    1587/    F67E : 42                  	DB	"B"
    1588/    F67F : C3                  	DB	'C'+80H
    1589/    F680 : (MACRO)             	ROTDP
    1589/    F680 : E7                          RST     20H
    1589/    F681 : 0D                          DB      0Dh                     ; OUTDP
    1590/    F682 : (MACRO)             	RPRST
    1590/    F682 : E7                          RST     20H
    1590/    F683 : 02                          DB      02h                     ; PRST
    1591/    F684 : 44                  	DB	"D"
    1592/    F685 : C5                  	DB	'E'+80H
    1593/    F686 : (MACRO)             	ROTDP
    1593/    F686 : E7                          RST     20H
    1593/    F687 : 0D                          DB      0Dh                     ; OUTDP
    1594/    F688 : (MACRO)             	RPRST
    1594/    F688 : E7                          RST     20H
    1594/    F689 : 02                          DB      02h                     ; PRST
    1595/    F68A : 48                  	DB	"H"
    1596/    F68B : CC                  	DB	'L'+80H
    1597/    F68C : (MACRO)             	ROTDP
    1597/    F68C : E7                          RST     20H
    1597/    F68D : 0D                          DB      0Dh                     ; OUTDP
    1598/    F68E : 10 E6               	DJNZ	RKO4
    1599/    F690 :                     ;
    1600/    F690 : 2A 2B 00            	LD	HL,(CUPOS)		;2. Satz als Schatten-
    1601/    F693 : 2B                  	DEC	HL			;register markieren:
    1602/    F694 : 36 27               	LD	(HL),27H		;"'"
    1603/    F696 : C9                  	RET
    1604/    F697 :                     ;
    1605/    F697 : 01 00 04            RKO3:	LD	BC,0400H		;B=4, C-Registernummer
    1606/    F69A : 2A 16 00            	LD	HL,(SOIL)
    1607/    F69D : 23                  	INC	HL
    1608/    F69E : 23                  	INC	HL
    1609/    F69F : 11 60 F6            	LD	DE,RKO2
    1610/    F6A2 : 1A                  RKO5:	LD	A,(DE)			;Vergleich Registereingabe
    1611/    F6A3 : BE                  	CP	A, (HL)			;mit allen Registern
    1612/    F6A4 : 28 17               	JR	Z, RKO8			;wenn gefunden
    1613/    F6A6 : 13                  	INC	DE
    1614/    F6A7 : E5                  RKO6:	PUSH	HL
    1615/    F6A8 : 21 05 00            	LD	HL,5
    1616/    F6AB : 19                  	ADD	HL,DE
    1617/    F6AC : EB                  	EX	DE,HL			;naechster Reg.name
    1618/    F6AD : E1                  	POP	HL
    1619/    F6AE : 0C                  	INC	C			;C-Registernummer
    1620/    F6AF : 10 F1               	DJNZ	RKO5
    1621/    F6B1 : 06 04               	LD	B,4
    1622/    F6B3 : 79                  	LD	A,C
    1623/    F6B4 : FE 08               	CP	A, 8
    1624/    F6B6 : 20 EA               	JR	NZ, RKO5		;weitersuchen
    1625/    F6B8 : F1                  	POP	AF			;sonst falsche Eingabe
    1626/    F6B9 : FF                  	RST	38H			;--> zum KDO-Monitor
    1627/    F6BA :                     ;
    1628/    F6BA : 2B                  RKO7:	DEC	HL			;weitersuchen
    1629/    F6BB : 18 EA               	JR	RKO6
    1630/    F6BD :                     ;
    1631/    F6BD : 13                  RKO8:	INC	DE			;Ueberpruefen zweiter
    1632/    F6BE : 23                  	INC	HL			;Buchstabe
    1633/    F6BF : 1A                  	LD	A,(DE)
    1634/    F6C0 : E6 7F               	AND	A, 7FH
    1635/    F6C2 : BE                  	CP	A, (HL)
    1636/    F6C3 : 20 F5               	JR	NZ, RKO7		;wenn ungleich
    1637/    F6C5 : 23                  	INC	HL
    1638/    F6C6 : 7E                  	LD	A,(HL)			;Schattenregister ?
    1639/    F6C7 : FE 27               	CP	A, 27H			;"'"
    1640/    F6C9 : 79                  	LD	A,C
    1641/    F6CA : 20 02               	JR	NZ, RKO9		;wenn nicht
    1642/    F6CC : C6 04               	ADD	A, 4
    1643/    F6CE : CB 27               RKO9:	SLA	A
    1644/    F6D0 : 4F                  	LD	C,A
    1645/    F6D1 : 06 00               	LD	B,0
    1646/    F6D3 : 21 64 00            	LD	HL,REGSP+1
    1647/    F6D6 : ED 42               	SBC	HL,BC
    1648/    F6D8 : 44                  	LD	B,H			;HL=Adresse im
    1649/    F6D9 : 4D                  	LD	C,L			;Registerrettebereich
    1650/    F6DA : (MACRO)             	ROTHS				;Ausgabe Wert
    1650/    F6DA : E7                          RST     20H
    1650/    F6DB : 0C                          DB      0Ch                     ; OTHLS
    1651/    F6DC : CD F0 F2            	CALL	INLIN			;Eingabe neuer Wert
    1652/    F6DF : ED 5B 16 00         	LD	DE,(SOIL)
    1653/    F6E3 : CD 31 F3            	CALL	INHEX			;HL=neuer Wert
    1654/    F6E6 : 20 04               	JR	NZ, RKO10		;wenn alles ok
    1655/    F6E8 : 1A                  	LD	A,(DE)			;keine Zahl, vielleicht
    1656/    F6E9 : FE 3B               	CP	A, ';'			;Abbruch ?
    1657/    F6EB : C8                  	RET	Z
    1658/    F6EC :                     ;
    1659/    F6EC : EB                  RKO10:	EX	DE,HL
    1660/    F6ED : C5                  	PUSH	BC
    1661/    F6EE : E1                  	POP	HL			;Adr. im Reg.rettebereich
    1662/    F6EF : 72                  	LD	(HL),D			;neuen Wert eintragen
    1663/    F6F0 : 2B                  	DEC	HL
    1664/    F6F1 : 73                  	LD	(HL),E
    1665/    F6F2 : C3 21 F6            	JP	REGDA			;Registeranzeige
    1666/    F6F5 :                     
    1667/    F6F5 : =>FALSE             	IF MONTYP == "Z1013_202"
    1668/    F6F5 :                     ;
    1669/    F6F5 :                     ;-------------------------------------------------------------------------------
    1670/    F6F5 :                     ;Hex-Umschaltung
    1671/    F6F5 :                     ;-------------------------------------------------------------------------------
    1672/    F6F5 :                     ;
    1673/    F6F5 :                     H_KDO:	ld	hl,5048h		;Aenderung der Tastaturcodetab.
    1674/    F6F5 :                     	ld	(LSYNC+15),hl		;Shift-Ebene 1, Zeile 2 und 3
    1675/    F6F5 :                     	ld	hl,3830h		;vertauschen mit
    1676/    F6F5 :                     	ld	(LSYNC+18),hl		;Shift-Ebene 0, Zeile 2 und 3
    1677/    F6F5 :                     	RET
    1678/    F6F5 :                     ;
    1679/    F6F5 :                     ;-------------------------------------------------------------------------------
    1680/    F6F5 :                     ;ASCII-Umschaltung
    1681/    F6F5 :                     ;-------------------------------------------------------------------------------
    1682/    F6F5 :                     ;
    1683/    F6F5 :                     A_KDO:	ld	hl,MONTB+2		;Laden der alten
    1684/    F6F5 :                     	ld	de,LSYNC+2		;Tastaturcodetab.
    1685/    F6F5 :                     	ld	bc,12h
    1686/    F6F5 :                     	ldir
    1687/    F6F5 :                     	RET
    1688/    F6F5 :                     
    1689/    F6F5 : [1667]              	ENDIF
    1690/    F6F5 :                     ;
    1691/    F6F5 :                     ;-------------------------------------------------------------------------------
    1692/    F6F5 :                     ;Window definieren
    1693/    F6F5 :                     ;-------------------------------------------------------------------------------
    1694/    F6F5 :                     ;
    1695/    F6F5 : CD 11 F7            W_KDO:	CALL	WKO1			;Kontrolle Parameter
    1696/    F6F8 : 38 4C               	JR	C, WKO3			;wenn Fehleingabe
    1697/    F6FA : 22 35 00            	LD	(WINDL),HL		;neue Werte eintragen
    1698/    F6FD : ED 43 3B 00         	LD	(WINDA),BC
    1699/    F701 : 2A 1D 00            	LD	HL,(ARG2)
    1700/    F704 : 22 3D 00            	LD	(WINDE),HL
    1701/    F707 : 2A 2B 00            	LD	HL,(CUPOS)		;Cursor loeschen
    1702/    F70A : 36 20               	LD	(HL),' '
    1703/    F70C : ED 43 2B 00         	LD	(CUPOS),BC		;Cursor home
    1704/    F710 : C9                  	RET
    1705/    F711 :                     ;
    1706/    F711 : 3A 1C 00            WKO1:	LD	A,(ARG1+1)
    1707/    F714 : FE EC               	CP	A, hi(BWS)		;innerhalb BWS ?
    1708/    F716 : D8                  	RET	C			;nein
    1709/    F717 : 3A 1B 00            	LD	A,(ARG1)		;WINDOW-Anfang
    1710/    F71A : E6 E0               	AND	A, 0E0H			;auf Zeilenanfang stellen
    1711/    F71C : 32 1B 00            	LD	(ARG1),A
    1712/    F71F : 3A 1D 00            	LD	A,(ARG2)		;ebenso WINDOW-Ende
    1713/    F722 : E6 E0               	AND	A, 0E0H			;auf Zeilenanfang stellen
    1714/    F724 : 32 1D 00            	LD	(ARG2),A
    1715/    F727 : 2A 1D 00            	LD	HL,(ARG2)
    1716/    F72A : ED 4B 1B 00         	LD	BC,(ARG1)
    1717/    F72E : ED 42               	SBC	HL,BC
    1718/    F730 : D8                  	RET	C			;Endadresse zu klein
    1719/    F731 : 28 11               	JR	Z, WKO2			;kein Window --> Fehler
    1720/    F733 : 2B                  	DEC	HL
    1721/    F734 : 3E 03               	LD	A,3			;WINDOW zu gross ?
    1722/    F736 : BC                  	CP	A, H
    1723/    F737 : D8                  	RET	C			;ja
    1724/    F738 : 23                  	INC	HL
    1725/    F739 : 11 40 00            	LD	DE,2*BWSCOL
    1726/    F73C : ED 52               	SBC	HL,DE
    1727/    F73E : D8                  	RET	C			;wenn WINDOW zu klein
    1728/    F73F : 11 20 00            	LD	DE,BWSCOL
    1729/    F742 : 19                  	ADD	HL,DE
    1730/    F743 : C9                  	RET
    1731/    F744 :                     ;
    1732/    F744 : 37                  WKO2:	SCF
    1733/    F745 : C9                  	RET
    1734/    F746 :                     ;
    1735/    F746 : F1                  WKO3:	POP	AF
    1736/    F747 : FF                  	RST	38H
    1737/    F748 :                     ;
    1738/    F748 :                     ;-------------------------------------------------------------------------------
    1739/    F748 :                     ;NEXT-Kommando, Step-Betrieb
    1740/    F748 :                     ;-------------------------------------------------------------------------------
    1741/    F748 :                     ;
    1742/    F748 :                     ;Initialisierungstabelle fuer PIO bei NEXT
    1743/    F748 :                     ;PIO B5 => AB0 in
    1744/    F748 :                     ;
    1745/    F748 : FE                  NKTA:	DB	Lo(NINTA)		;Interruptvektor Low Byte
    1746/    F749 : 97                  	DB	10010111b		;Interruptsteuerwort, EI, Low-aktiv, Mask folgt
    1747/    F74A : DF                  	DB	11011111b		;Interruptmaske Bit5 aktiv
    1748/    F74B :                     ;
    1749/    F74B :                     ;NEXT-Kommando
    1750/    F74B :                     ;
    1751/    F74B : 3E F7               N_KDO:	LD	A,Hi(NINTA)
    1752/    F74D : ED 47               	LD	I,A			;Interruptvektor
    1753/    F74F : F3                  	DI
    1754/    F750 : 21 48 F7            	LD	HL,NKTA 		;Initialisieren PIO Port B
    1755/    F753 : 01 03 03            	LD	BC,0303H		;3 Bytes, Port PIOBC
    1756/    F756 : ED B3               	OTIR				;loest selbstaendig INT aus
    1757/    F758 : 2A 0B 00            	LD	HL,(BPADR)		;Byte vor Breakadr.(!)
    1758/    F75B : 2B                  	DEC	HL			;wird EI
    1759/    F75C : 7E                  	LD	A,(HL)
    1760/    F75D : 32 69 00            	LD	(NBYTE),A		;Byte retten
    1761/    F760 : 36 FB               	LD	(HL),0FBH		;Code EI einschreiben
    1762/    F762 : ED 73 6A 00         	LD	(SPADR),SP
    1763/    F766 : ED 7B 63 00         	LD	SP,(REGSP)
    1764/    F76A : E5                  	PUSH	HL			;Adr. mit EI-Befehl
    1765/    F76B : C3 87 F5            	JP	REGH			;Register holen und Start
    1766/    F76E :                     ;Die PIO generiert bereits beim OTIR eine Interruptanforderung, da dabei AB0 => 0.
    1767/    F76E :                     ;Sobald EI und nachfolgender Befehl ausgeführt wird, wird der Interrupt angenommen
    1768/    F76E :                     ;und nachfolgende Routine über Inhalt der Adr. NINTA angesprungen (da IM 2)
    1769/    F76E :                     ;
    1770/    F76E :                     ;Eingang bei Interrupt
    1771/    F76E : F3                  NINTR:	DI
    1772/    F76F : CD 70 F5            	CALL	REGA			;Register retten
    1773/    F772 : 3E 07               	LD	A,00000111b		;Interrupt von PIO
    1774/    F774 : D3 03               	OUT	PIOBC, A		;verbieten
    1775/    F776 : 2A 0B 00            	LD	HL,(BPADR)		;EI-Befehl durch Original-
    1776/    F779 : 2B                  	DEC	HL			;Byte ersetzen
    1777/    F77A : 3A 69 00            	LD	A,(NBYTE)
    1778/    F77D : 77                  	LD	(HL),A
    1779/    F77E : E1                  	POP	HL
    1780/    F77F : 22 0B 00            	LD	(BPADR),HL		;neue Breakadresse
    1781/    F782 : 22 61 00            	LD	(REGPC),HL
    1782/    F785 : ED 73 63 00         	LD	(REGSP),SP
    1783/    F789 : ED 7B 6A 00         	LD	SP,(SPADR)		;neue Operandenfolge
    1784/    F78D : 11 0D 00            	LD	DE,BPOPC		;umladen
    1785/    F790 : 01 03 00            	LD	BC,3
    1786/    F793 : ED B0               	LDIR
    1787/    F795 : 21 21 F6            	LD	HL,REGDA
    1788/    F798 : E5                  	PUSH	HL
    1789/    F799 : ED 4D               	RETI				;Sprung zur Registeranzeige
    1790/    F79B :                     ;
    1791/    F79B :                     ;-------------------------------------------------------------------------------
    1792/    F79B :                     ;Speicherbereiche vergleichen
    1793/    F79B :                     ;-------------------------------------------------------------------------------
    1794/    F79B :                     ;
    1795/    F79B : CD 3C F5            C_KDO:	CALL	PARA			;Parameter holen
    1796/    F79E : 1A                  CKO1:	LD	A,(DE)
    1797/    F79F : BE                  	CP	A, (HL)			;Vergleich
    1798/    F7A0 : 20 08               	JR	NZ, CKO3		;wenn ungleich
    1799/    F7A2 : 0B                  CKO2:	DEC	BC
    1800/    F7A3 : 23                  	INC	HL
    1801/    F7A4 : 13                  	INC	DE
    1802/    F7A5 : 78                  	LD	A,B
    1803/    F7A6 : B1                  	OR	C
    1804/    F7A7 : C8                  	RET	Z			;wenn alles geprueft
    1805/    F7A8 : 18 F4               	JR	CKO1			;sonst weitertesten
    1806/    F7AA :                     ;
    1807/    F7AA : (MACRO)             CKO3:	ROTHL				;1. Adresse
    1807/    F7AA : E7                          RST     20H
    1807/    F7AB : 07                          DB      07h                     ; OUTHL
    1808/    F7AC : (MACRO)             	ROTSP
    1808/    F7AC : E7                          RST     20H
    1808/    F7AD : 0E                          DB      0Eh                     ; OUTSP
    1809/    F7AE : 7E                  	LD	A,(HL)
    1810/    F7AF : (MACRO)             	ROTHX				;1. Byte
    1810/    F7AF : E7                          RST     20H
    1810/    F7B0 : 06                          DB      06h                     ; OUTHX
    1811/    F7B1 : (MACRO)             	ROTSP
    1811/    F7B1 : E7                          RST     20H
    1811/    F7B2 : 0E                          DB      0Eh                     ; OUTSP
    1812/    F7B3 : EB                  	EX	DE,HL
    1813/    F7B4 : (MACRO)             	ROTHL				;2. Adresse
    1813/    F7B4 : E7                          RST     20H
    1813/    F7B5 : 07                          DB      07h                     ; OUTHL
    1814/    F7B6 : (MACRO)             	ROTSP
    1814/    F7B6 : E7                          RST     20H
    1814/    F7B7 : 0E                          DB      0Eh                     ; OUTSP
    1815/    F7B8 : EB                  	EX	DE,HL
    1816/    F7B9 : 1A                  	LD	A,(DE)
    1817/    F7BA : (MACRO)             	ROTHX				;2. Byte
    1817/    F7BA : E7                          RST     20H
    1817/    F7BB : 06                          DB      06h                     ; OUTHX
    1818/    F7BC : (MACRO)             	RPRST
    1818/    F7BC : E7                          RST     20H
    1818/    F7BD : 02                          DB      02h                     ; PRST
    1819/    F7BE : 8D                  	DB	CR+80H
    1820/    F7BF : (MACRO)             	RINCH				;warten auf Tastendruck
    1820/    F7BF : E7                          RST     20H
    1820/    F7C0 : 01                          DB      01h                     ; INCH
    1821/    F7C1 : FE 0D               	CP	A, CR
    1822/    F7C3 : C0                  	RET	NZ			;Abbruch wenn <> >ENTER<
    1823/    F7C4 : 18 DC               	JR	CKO2			;sonst weitertesten
    1824/    F7C6 :                     
    1825/    F7C6 : =>FALSE             	IF	MONTYP <> "Z1013_A2"
    1826/    F7C6 :                     ;
    1827/    F7C6 :                     ;-------------------------------------------------------------------------------
    1828/    F7C6 :                     ;Bytefolge suchen
    1829/    F7C6 :                     ;-------------------------------------------------------------------------------
    1830/    F7C6 :                     ;
    1831/    F7C6 :                     F_KDO:	LD	DE,(SOIL2)
    1832/    F7C6 :                     	DEC	DE
    1833/    F7C6 :                     	DEC	DE
    1834/    F7C6 :                     	LD	(ARG3),DE		;DE = Beginn Bytefolge
    1835/    F7C6 :                     	LD	BC,(ARG1)		;Suchadresse
    1836/    F7C6 :                     FKO1:	LD	DE,(ARG3)
    1837/    F7C6 :                     	RINHX				;L = 1. Suchbyte
    1838/    F7C6 :                     FKO2:	LD	A,(BC)
    1839/    F7C6 :                     	CP	A, L			;L = Suchbyte
    1840/    F7C6 :                     	JR	Z, FKO3			;wenn Bytes gleich
    1841/    F7C6 :                     	INC	BC			;sonst naechste Suchadresse
    1842/    F7C6 :                     	LD	A,B
    1843/    F7C6 :                     	OR	C
    1844/    F7C6 :                     	JR	Z, FKO7			;wenn Speicherende erreicht
    1845/    F7C6 :                     	JR	FKO2			;weitersuchen
    1846/    F7C6 :                     ;
    1847/    F7C6 :                     FKO3:	PUSH	BC
    1848/    F7C6 :                     	PUSH	DE
    1849/    F7C6 :                     	LD	DE,(ARG2)		;Suchbyteanzahl
    1850/    F7C6 :                     	DEC	DE
    1851/    F7C6 :                     	LD	(FBANZ),DE		;Zwischenspeicher fuer Anzahl
    1852/    F7C6 :                     	INC	BC
    1853/    F7C6 :                     FKO4:	LD	A,D
    1854/    F7C6 :                     	OR	E			;alle Suchbytes verglichen?
    1855/    F7C6 :                     	POP	DE
    1856/    F7C6 :                     	JR	Z, FKO5			;wenn Bytefolge gefunden
    1857/    F7C6 :                     	RINHX				;naechstes Suchbyte holen
    1858/    F7C6 :                     	LD	A,(BC)
    1859/    F7C6 :                     	CP	A, L
    1860/    F7C6 :                     	JR	NZ, FKO6		;wenn Folge nicht gefunden
    1861/    F7C6 :                     	PUSH	DE
    1862/    F7C6 :                     	LD	DE,(FBANZ)		;1 Byte weniger zu vergleichen
    1863/    F7C6 :                     	DEC	DE
    1864/    F7C6 :                     	LD	(FBANZ),DE
    1865/    F7C6 :                     	INC	BC
    1866/    F7C6 :                     	JR	FKO4			;weitervergleichen
    1867/    F7C6 :                     ;Bytefolge gefunden
    1868/    F7C6 :                     FKO5:	POP	BC
    1869/    F7C6 :                     	LD	(ARG1),BC
    1870/    F7C6 :                     	JP	MEM			;Speicher modifizieren
    1871/    F7C6 :                     ;
    1872/    F7C6 :                     FKO6:	POP	BC
    1873/    F7C6 :                     	INC	BC
    1874/    F7C6 :                     	JR	FKO1
    1875/    F7C6 :                     ;Bytefolge nirgends gefunden
    1876/    F7C6 :                     FKO7:	RPRST
    1877/    F7C6 :                     	DB	"NOT FOUND"
    1878/    F7C6 :                     	DB	CR+80H
    1879/    F7C6 :                     	RET
    1880/    F7C6 :                     
    1881/    F7C6 : [1825]              	ENDIF
    1882/    F7C6 :                     
    1883/    F7C6 : =>TRUE              	IF MONTYP == "Z1013_A2"
    1884/    F7C6 :                     ;
    1885/    F7C6 :                     ;-------------------------------------------------------------------------------
    1886/    F7C6 :                     ; Tastaturcodetabelle
    1887/    F7C6 :                     ;-------------------------------------------------------------------------------
    1888/    F7C6 :                     ;
    1889/    F7C6 :                     keytab:
    1890/    F7C6 :                     ; spalte 0
    1891/    F7C6 : 31                  	db  31h ; 1
    1892/    F7C7 : 51                  	db  51h ; Q
    1893/    F7C8 : 41                  	db  41h ; A
    1894/    F7C9 : 59                  	db  59h ; Y
    1895/    F7CA : 32                  	db  32h ; 2
    1896/    F7CB : 57                  	db  57h ; W
    1897/    F7CC : 53                  	db  53h ; S
    1898/    F7CD : 58                  	db  58h ; X
    1899/    F7CE :                     ; Spalte 1
    1900/    F7CE : 33                  	db  33h ; 3
    1901/    F7CF : 45                  	db  45h ; E
    1902/    F7D0 : 44                  	db  44h ; D
    1903/    F7D1 : 43                  	db  43h ; C
    1904/    F7D2 : 34                  	db  34h ; 4
    1905/    F7D3 : 52                  	db  52h ; R
    1906/    F7D4 : 46                  	db  46h ; F
    1907/    F7D5 : 56                  	db  56h ; V
    1908/    F7D6 :                     ; Spalte 2
    1909/    F7D6 : 35                  	db  35h ; 5
    1910/    F7D7 : 54                  	db  54h ; T
    1911/    F7D8 : 47                  	db  47h ; G
    1912/    F7D9 : 42                  	db  42h ; B
    1913/    F7DA : 36                  	db  36h ; 6
    1914/    F7DB : 5A                  	db  5Ah ; Z
    1915/    F7DC : 48                  	db  48h ; H
    1916/    F7DD : 4E                  	db  4Eh ; N
    1917/    F7DE :                     ; Spalte 3
    1918/    F7DE : 37                  	db  37h ; 7
    1919/    F7DF : 55                  	db  55h ; U
    1920/    F7E0 : 4A                  	db  4Ah ; J
    1921/    F7E1 : 4D                  	db  4Dh ; M
    1922/    F7E2 : 38                  	db  38h ; 8
    1923/    F7E3 : 49                  	db  49h ; I
    1924/    F7E4 : 4B                  	db  4Bh ; K
    1925/    F7E5 : 2C                  	db  2Ch ; ,
    1926/    F7E6 :                     ; Spalte 4
    1927/    F7E6 : 39                  	db  39h ; 9
    1928/    F7E7 : 4F                  	db  4Fh ; O
    1929/    F7E8 : 4C                  	db  4Ch ; L
    1930/    F7E9 : 2E                  	db  2Eh ; .
    1931/    F7EA : 30                  	db  30h ; 0
    1932/    F7EB : 50                  	db  50h ; P
    1933/    F7EC : 2B                  	db  2Bh ; +
    1934/    F7ED : 2F                  	db  2Fh ; /
    1935/    F7EE :                     ; Spalte 5
    1936/    F7EE : 2D                  	db  2Dh ; -
    1937/    F7EF : 40                  	db  40h ; @
    1938/    F7F0 : 2A                  	db  2Ah ; *
    1939/    F7F1 : 5E                  	db  5Eh ; ^
    1940/    F7F2 : 5B                  	db  5Bh ; [
    1941/    F7F3 : 5D                  	db  5Dh ; ]
    1942/    F7F4 : 5C                  	db  5Ch ;
    1943/    F7F5 : 5F                  	db  5Fh ; _
    1944/    F7F6 :                     ; Spalte 6
    1945/    F7F6 : 00                  tab2:	db    0 ; Graph E/A
    1946/    F7F7 : 0D                  	db  0Dh ; ENT
    1947/    F7F8 : 08                  	db    8 ; Cu. links
    1948/    F7F9 : 09                  	db    9 ; Cu. rechts
    1949/    F7FA : 20                  	db  20h ; Leerz.
    1950/    F7FB : 00                  	db    0 ; CTRL
    1951/    F7FC : 0B                  	db  0Bh ; Cu. hoch
    1952/    F7FD : 0A                  	db  0Ah ; Cu. runter
    1953/    F7FE :                     
    1954/    F7FE : [1883]              	ENDIF
    1955/    F7FE :                     
    1956/    F7FE :                     ;
    1957/    F7FE :                     ;-------------------------------------------------------------------------------
    1958/    F7FE :                     ;Interrupttabelle fuer Break
    1959/    F7FE :                     ;-------------------------------------------------------------------------------
    1960/    F7FE :                     ;
    1961/    F7FE :                     
    1962/    F7FE :                     	align	2
    1963/    F7FE : 6E F7               NINTA:	DW	NINTR
    1964/    F800 :                     
    1965/    F800 :                     	END
 AS V1.42 Beta [Bld 82] - source file z1013riesa.asm - page 2 - 9/1/2012 11:11:05


  symbol table (* = unused):
  ------------------------

*ARCHITECTURE :  i386-unknown-win32 - |  ARG1 :                          1B - |
 ARG2 :                          1D - |  ARG3 :                          23 - |
 AUS1 :                        F610 C |  AUSX :                        F615 C |
*BIGENDIAN :                      0 - |  BPADR :                          B - |
 BPOPC :                          D - | *BRANCHEXT :                      0 - |
 BREAK :                       F5A1 C |  BUFFA :                         1F - |
 BWS :                         EC00 - |  BWSCOL :                        20 - |
 BWSROW :                        20 - |  BWSSZ :                        400 - |
 B_KDO :                       F5C4 C | *CASESENSITIVE :                  0 - |
 CKO1 :                        F79E C |  CKO2 :                        F7A2 C |
 CKO3 :                        F7AA C |  CLOAD :                       F435 C |
 CLS :                            C - | *CONSTPI :        3.141592653589793 - |
 CR :                             D - |  CSAVE :                       F3A6 C |
 CUPOS :                         2B - |  C_KDO :                       F79B C |
 DATA :                          13 - | *DATE :                    9/1/2012 - |
 DKO1 :                        F50E C |  DKO2 :                        F51F C |
 DKO3 :                        F52D C |  D_KDO :                       F50B C |
*ESC :                           1B - |  E_KDO :                       F5D6 C |
*FALSE :                          0 - | *FBANZ :                         6C - |
*FULLPMMU :                       1 - |  G_KDO :                       F5F0 C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 INC1 :                        F221 C |  INC2 :                        F232 C |
 INC3 :                        F23C C |  INC4 :                        F241 C |
 INC5 :                        F248 C |  INC6 :                        F24A C |
 INCH :                        F219 C | *INEXTMODE :                      0 - |
 INHEX :                       F331 C | *INIT :                        F000 C |
 INIT1 :                       F002 C |  INIT2 :                       F00F C |
 INK1 :                        F136 C |  INK10 :                       F18F C |
 INK11 :                       F19F C |  INK12 :                       F1A3 C |
 INK13 :                       F1AE C |  INK14 :                       F1B0 C |
 INK15 :                       F1B4 C |  INK16 :                       F1B9 C |
 INK17 :                       F1BB C |  INK18 :                       F1C0 C |
 INK19 :                       F1CE C |  INK2 :                        F14D C |
 INK20 :                       F1F9 C |  INK21 :                       F1FE C |
 INK22 :                       F205 C |  INK3 :                        F151 C |
 INK4 :                        F159 C |  INK5 :                        F15B C |
 INK6 :                        F16A C |  INK7 :                        F16C C |
 INK8 :                        F172 C |  INK9 :                        F17C C |
 INKEY :                       F119 C |  INLIN :                       F2F0 C |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
 INS1 :                        F2FD C | *INSRCMODE :                      0 - |
 INSTR :                       F2F6 C | *INSUPMODE :                      0 - |
 J_KDO :                       F5E2 C |  KDO1 :                        F053 C |
 KDO2 :                        F059 C |  KDO3 :                        F071 C |
 KDO4 :                        F07E C |  KDO5 :                        F087 C |
 KDO6 :                        F09C C |  KDOTB :                       F0A7 C |
 KEYP :                           8 - |  KEYTAB :                      F7C6 C |
 KON1 :                        F318 C |  KON2 :                        F329 C |
 KONVX :                       F30E C |  KYBTS :                         37 - |
 K_KDO :                       F548 C |  LAKEY :                          4 - |
*LF :                             A - | *LISTON :                         1 - |
 LOA1 :                        F438 C |  LOA10 :                       F483 C |
 LOA11 :                       F490 C |  LOA12 :                       F49D C |
 LOA13 :                       F4A0 C |  LOA14 :                       F4B8 C |
 LOA15 :                       F4BA C |  LOA16 :                       F4BE C |
 LOA17 :                       F4C4 C |  LOA18 :                       F4C9 C |
 LOA19 :                       F4DA C |  LOA2 :                        F449 C |
 LOA20 :                       F4DD C |  LOA21 :                       F4E5 C |
 LOA22 :                       F4E6 C |  LOA23 :                       F4F7 C |
 LOA24 :                       F4F9 C |  LOA25 :                       F503 C |
 LOA26 :                       F4F2 C |  LOA27 :                       F4CB C |
 LOA3 :                        F454 C |  LOA5 :                        F45C C |
 LOA6 :                        F461 C |  LOA7 :                        F467 C |
 LOA8 :                        F472 C |  LOA9 :                        F47E C |
 LSYNC :                         33 - | *MACEXP :                         1 - |
 MEM :                         F362 C |  MEM1 :                        F365 C |
 MEM2 :                        F378 C |  MEM3 :                        F37F C |
 MEM4 :                        F38C C | *MOMCPU :                        80 - |
*MOMCPUNAME :                   Z80 - |  MONTB :                       F20D C |
 MONTYP :                  Z1013_A2 - |  NBYTE :                         69 - |
*NESTMAX :                      100 - |  NINTA :                       F7FE C |
 NINTR :                       F76E C |  NKTA :                        F748 C |
*NL :                            1E - | *NMI :                           66 - |
 N_KDO :                       F74B C |  OTHLS :                       F604 C |
 OUT0 :                        F256 C |  OUT10 :                       F2CB C |
 OUT2 :                        F276 C |  OUT3 :                        F277 C |
 OUT5 :                        F293 C |  OUT6 :                        F2AB C |
 OUT7 :                        F2B9 C |  OUT8 :                        F2BC C |
 OUT9 :                        F2C2 C |  OUTCH :                       F258 C |
 OUTDP :                       F601 C |  OUTHL :                       F357 C |
 OUTHX :                       F33E C |  OUTSP :                       F60C C |
 OUX1 :                        F347 C |  OUX2 :                        F352 C |
*PACKING :                        0 - | *PADDING :                        1 - |
 PARA :                        F53C C | *PIOAC :                          1 - |
*PIOAD :                          0 - |  PIOBC :                          3 - |
 PIOBD :                          2 - |  PRS1 :                        F2E3 C |
 PRST7 :                       F2E2 C |  R20BT :                          3 - |
 REG1 :                        F59C C |  REGA :                        F570 C |
 REGAF :                         5B - |  REGBR :                         4D - |
 REGDA :                       F621 C |  REGH :                        F587 C |
 REGPC :                         61 - |  REGSP :                         63 - |
*RELAXED :                        0 - |  RKO1 :                        F635 C |
 RKO10 :                       F6EC C |  RKO2 :                        F660 C |
 RKO3 :                        F697 C |  RKO4 :                        F676 C |
 RKO5 :                        F6A2 C |  RKO6 :                        F6A7 C |
 RKO7 :                        F6BA C |  RKO8 :                        F6BD C |
 RKO9 :                        F6CE C |  RST1 :                        F0D5 C |
 RST20 :                         20 - | *RST38 :                         38 - |
 RSTTB :                       F0F5 C |  R_KDO :                       F61C C |
 SAV1 :                        F3AC C |  SAV10 :                       F3EE C |
 SAV11 :                       F3FE C |  SAV12 :                       F402 C |
 SAV13 :                       F407 C |  SAV14 :                       F40D C |
 SAV15 :                       F40F C |  SAV16 :                       F417 C |
 SAV17 :                       F41C C |  SAV18 :                       F41F C |
 SAV19 :                       F421 C |  SAV2 :                        F3BA C |
 SAV20 :                       F42A C |  SAV21 :                       F42E C |
 SAV3 :                        F3C0 C |  SAV4 :                        F3C3 C |
 SAV5 :                        F3C5 C |  SAV6 :                        F3D1 C |
 SAV7 :                        F3D3 C |  SAV8 :                        F3E3 C |
 SAV9 :                        F3EA C |  SOIL :                          16 - |
 SOIL2 :                         25 - |  SPACE :                       F307 C |
 SPADR :                         6A - |  SYSSK :                         B0 - |
 TAB2 :                        F7F6 C | *TIME :                    11:11:05 - |
 TKO1 :                        F567 C | *TRUE :                           1 - |
 T_KDO :                       F55A C |  USRKD :                         B0 - |
 USRSK :                         90 - | *VERSION :                     142F - |
 WINDA :                         3B - |  WINDE :                         3D - |
 WINDL :                         35 - |  WKO1 :                        F711 C |
 WKO2 :                        F744 C |  WKO3 :                        F746 C |
 W_KDO :                       F6F5 C |

    241 symbols
     37 unused symbols

 AS V1.42 Beta [Bld 82] - source file z1013riesa.asm - page 3 - 9/1/2012 11:11:05


  defined macros:
  ---------------

RINCH                                 | RINHX                                
RINKY                                 | RINLN                                
ROTDP                                 | ROTHL                                
ROTHS                                 | ROTHX                                
ROTSP                                 | ROUTC                                
RPRST                                 |

     11 macros

 AS V1.42 Beta [Bld 82] - source file z1013riesa.asm - page 4 - 9/1/2012 11:11:05


  defined functions:
  ------------------

LO                                    | HI                                   

 AS V1.42 Beta [Bld 82] - source file z1013riesa.asm - page 5 - 9/1/2012 11:11:05


  codepages:
  ----------

STANDARD (0 changed characters)


0.07 seconds assembly time

   1966 lines source file
   2074 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
